<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Flap</title>
    <link href="https://fonts.googleapis.com/css2?family=Karla:wght@400;800&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body, html { background-color: #050110; margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; }
        canvas {
            display: block;
            background-color: #050110;
            background-image: url(https://res.cloudinary.com/di8j84ent/image/upload/q_auto/v1715551523/stars2_ogze9l.gif);
            background-size: 50%;
            margin: auto;
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
        }
        #startButton, #restartButton {
            display: none;
            position: absolute;
            left: 50%;
            top: 70%;
            transform: translate(-50%, -50%);
            font-size: 20px;
            font-weight: bold;
            padding: 15px;
            cursor: pointer;
            border: 3px solid #eee;
            background-color: transparent;
            color: #eee;
            border-radius: 8px;
            font-family: 'Roboto Mono';
        }
        #startButton:hover, #restartButton:hover {
            border: 3px solid #ff4a8b;
            color: #ff4a8b;
        }
        #instructions {
            display: none;
            position: absolute;
            width: calc(100% - 40px); /* Adjust width to fit the screen */
            max-width: 600px; /* Optional: Add a max-width for larger screens */
            box-sizing: border-box; /* Include padding in the width */
            text-align: center;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            color: white;
            font-family: 'Roboto Mono';
            z-index: 99;
            padding: 10px; /* Added padding */
        }
        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-20px);
            }
        }
        .float img {
            animation: float 3s ease-in-out infinite;
        }
        @media (max-width: 420px) {
            #instructions {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="instructions"><div class="float"><img src="https://res.cloudinary.com/di8j84ent/image/upload/q_auto/v1715475408/spaceship-sprite_w3gb6f.svg" height="60px" ></div><p>Click or tap to make the spaceship fly!<p>Avoid the planets to score points!</div>
    <button id="startButton">Start Game</button>
    <button id="restartButton">Restart Game</button>
<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const spaceshipImg = new Image();
    const wiggleImg = new Image();
    const planetImgs = [
        new Image(), new Image(), new Image(),
        new Image(), new Image(), new Image()  // Additional planets
    ];
    let imagesLoaded = 0;

    function imageLoaded() {
        imagesLoaded++;
        if (imagesLoaded === 8) { // Including spaceship, wiggle, and six planets
            showStartScreen();
        }
    }

    spaceshipImg.onload = wiggleImg.onload = imageLoaded;
    planetImgs.forEach(img => img.onload = imageLoaded);

    spaceshipImg.src = 'https://res.cloudinary.com/di8j84ent/image/upload/q_auto/v1715475408/spaceship-sprite_w3gb6f.svg';
    wiggleImg.src = 'https://res.cloudinary.com/di8j84ent/image/upload/q_auto/v1715536531/wiggle_znkcd5.svg';
    planetImgs[0].src = 'https://res.cloudinary.com/di8j84ent/image/upload/q_auto/v1715566824/planet7-sprite_aqzbyk.png';
    planetImgs[1].src = 'https://res.cloudinary.com/di8j84ent/image/upload/q_auto/v1715475427/planet1-sprite_jjv5jp.png';
    planetImgs[2].src = 'https://res.cloudinary.com/di8j84ent/image/upload/q_auto/v1715475424/planet2-sprite_hlvcbm.png';
    planetImgs[3].src = 'https://res.cloudinary.com/di8j84ent/image/upload/q_auto/v1715523872/planet4-sprite_wkahed.png';
    planetImgs[4].src = 'https://res.cloudinary.com/di8j84ent/image/upload/q_auto/v1715523868/planet5-sprite_s6xhyf.png';
    planetImgs[5].src = 'https://res.cloudinary.com/di8j84ent/image/upload/q_auto/v1715523865/planet6-sprite_agttqs.png';

    let spaceship, planets, frame, score, gameOver, scrollOffset = 0;
    const spaceshipWidth = 60;
    const spaceshipHeight = 42;
    const borderHeight = 25; // Height of the wiggle border at the top and bottom

    function init() {
        spaceship = { x: 100, y: (canvas.height - 2 * borderHeight) / 2 + borderHeight, vy: 0 };
        planets = [];
        frame = 0;
        score = 0;
        gameOver = false;
        scrollOffset = 0;
        resizeCanvas();
        gameLoop();
        startButton.style.display = 'none';
        restartButton.style.display = 'none';
        instructions.style.display = 'none';
    }

    window.addEventListener('resize', resizeCanvas);
    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        drawBorders();
    }

    startButton.addEventListener('click', startGame);
    restartButton.addEventListener('click', init);
    canvas.addEventListener('click', function() {
        if (!gameOver) {
            spaceship.vy = -5;
        }
    });

    function startGame() {
        init();
    }

    function drawSpaceship() {
        ctx.drawImage(spaceshipImg, spaceship.x, spaceship.y, spaceshipWidth, spaceshipHeight);
    }

    function updateSpaceship() {
        spaceship.vy += 0.1;  // Gravity effect
        spaceship.y += spaceship.vy;

        // Check for collision with the top and bottom borders
        if (spaceship.y < borderHeight || spaceship.y > canvas.height - spaceshipHeight - borderHeight) {
            endGame();  // Call end game function if collision occurs
        }
    }

    function drawPlanets() {
        planets.forEach(planet => {
            const size = planet.size * 50;
            ctx.drawImage(planet.img, planet.x, planet.y, size, size);
        });
    }

    function updatePlanets() {
        if (frame % 100 === 0) {
            const size = Math.random() * 0.5 + 0.5;
            const y = Math.random() * ((canvas.height - 2 * borderHeight) - (size * 50)) + borderHeight;
            planets.push({
                x: canvas.width,
                y,
                img: planetImgs[Math.floor(Math.random() * planetImgs.length)],
                size: size,
                passed: false
            });
        }
        planets.forEach(planet => {
            planet.x -= 2;
            if (!planet.passed && planet.x + planet.size * 50 < spaceship.x) {
                planet.passed = true;
                score++;
            }
        });
        planets = planets.filter(planet => planet.x + planet.size * 50 > 0);
    }

    function checkCollision() {
        planets.forEach(planet => {
            const size = planet.size * 50;
            if (spaceship.x < planet.x + size && spaceship.x + spaceshipWidth > planet.x &&
                spaceship.y < planet.y + size && spaceship.y + spaceshipHeight > planet.y &&
                planet.y > borderHeight && planet.y + size < canvas.height - borderHeight) {
                endGame();
            }
        });
    }

    function scoreDisplay() {
        ctx.fillStyle = 'white';
        ctx.font = '24px Roboto Mono';
        const scorePositionX = 20;
        const scorePositionY = 50;  
        ctx.fillText(`Score: ${score}`, scorePositionX, scorePositionY);
    }

    function drawBorders() {
        const patternHeight = 25;
        const patternRepeat = Math.ceil(canvas.width / wiggleImg.width) + 1;
        scrollOffset = (scrollOffset - 3) % wiggleImg.width;

        ctx.save();
        ctx.translate(scrollOffset, 0);
        for (let i = -1; i < patternRepeat; i++) {
            ctx.drawImage(wiggleImg, i * wiggleImg.width, 0, wiggleImg.width, patternHeight);
            ctx.save();
            ctx.scale(1, -1);
            ctx.drawImage(wiggleImg, i * wiggleImg.width, -canvas.height, wiggleImg.width, patternHeight);
            ctx.restore();
        }
        ctx.restore();
    }

    let bgOffset = 0;

    function updateBackground() {
        bgOffset -= 0.5; // This controls the speed of the background scrolling to the left
        canvas.style.backgroundImage = "url('https://res.cloudinary.com/di8j84ent/image/upload/q_auto/v1715551523/stars2_ogze9l.gif')";
        canvas.style.backgroundPosition = `${bgOffset}px 0`;
    }

    function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        updateBackground(); // Update the background position in each frame
        drawBorders();
        drawSpaceship();
        updateSpaceship();
        drawPlanets();
        updatePlanets();
        checkCollision();
        if (!gameOver) {
            scoreDisplay(); // Only display the score if the game is not over
        }
        frame++;
        if (!gameOver) {
            requestAnimationFrame(gameLoop);
        }
    }

    function endGame() {
        gameOver = true;
        ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear the canvas to avoid drawing over other elements
        drawBorders(); // Redraw borders to keep them visible
        ctx.font = '36px Roboto Mono'; // Large font for "Game Over"
        ctx.fillStyle = 'white';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';

        // Display "Game Over" at the center of the canvas
        ctx.fillText("Game Over!", canvas.width / 2, canvas.height / 2 - 40);

        // Use a smaller font for the score below the "Game Over" message
        ctx.font = '24px Roboto Mono';
        ctx.fillText(`Score: ${score}`, canvas.width / 2, canvas.height / 2 + 20);

        restartButton.style.display = 'block';
    }

    function showStartScreen() {
        ctx.fillStyle = '#44148f';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        drawBorders();  // Draw the borders on the start screen
        instructions.style.display = 'block';
        startButton.style.display = 'block';
    }

    window.onload = resizeRef = resizeCanvas;
</script>
</body>
</html>
