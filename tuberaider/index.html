<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- Sets the browser address bar color to match the site background on mobile -->
    <meta name="theme-color" content="#05070a">
    <title>TubeRaider</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css" />
    <style>
      :root {
        --bg-dark: #05070a;
        --bg-card: #131824;
        --bg-hover: #1a2235;
        --accent: #26b58b;
        --accent-light: #2ecfa1;
        --text-primary: #ffffff;
        --text-secondary: #b0b9cc;
        --text-tertiary: #7a8299;
        --border: #1f2937;
        --gold: #f0c76a;
        --live-red: #ff4444;
        --live-bg: rgba(255, 68, 68, 0.15);
        --background-image: url("scene.webp");
        font-family: "Outfit", system-ui, -apple-system, sans-serif;
        font-size: 16px; /* Base font size adjusted for mobile readability */
      }

      * {
        box-sizing: border-box;
        scrollbar-width: thin;
        scrollbar-color: #3b4554 #0a0e17;
        /* Disable blue highlight on tap for mobile */
        -webkit-tap-highlight-color: transparent;
      }

      *::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }

      *::-webkit-scrollbar-track {
        background: #0a0e17;
      }

      *::-webkit-scrollbar-thumb {
        background: #3b4554;
        border-radius: 4px;
      }

      body {
        margin: 0;
        padding: 0;
        background: linear-gradient(180deg, var(--bg-dark) 0%, #0f1420 100%);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
        position: relative;
        overflow-x: hidden; /* Prevent horizontal scroll on body */
      }

      body::before {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        width: 1000px;
        height: 543px;
        background-image: var(--background-image);
        background-repeat: no-repeat;
        background-size: contain;
        opacity: 0.5;
        pointer-events: none;
        z-index: -1;
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      /* HEADER */
      .header {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: rgba(5, 7, 10, 0.95);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border-bottom: 1px solid rgba(31, 41, 55, 0.5);
        padding: 16px 0;
        transition: padding 0.3s;
      }

      .header-inner {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 40px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .brand-icon {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1rem;
        color: #020308;
        box-shadow: 0 0 15px rgba(46, 207, 161, 0.3);
      }

      .brand-name {
        font-weight: 700;
        font-size: 1.5rem;
        letter-spacing: 0.15em;
        background: linear-gradient(135deg, var(--accent-light), var(--gold));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .header-info {
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .info-pill {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: rgba(38, 181, 139, 0.05);
        border: 1px solid rgba(38, 181, 139, 0.2);
        border-radius: 20px;
        font-size: 0.85rem;
        color: var(--text-secondary);
        white-space: nowrap;
      }

      .info-pill i {
        font-size: 0.95rem;
        color: var(--accent);
      }

      /* MAIN */
      main {
        max-width: 1400px;
        margin: 0 auto;
        padding: 40px;
      }

      .hero-section {
        margin-bottom: 50px;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
      }

      .hero-text h1 {
        font-size: 3.5rem;
        font-weight: 800;
        margin: 0 0 16px;
        line-height: 1.1;
        color: var(--text-primary);
      }

      .hero-text p {
        font-size: 1.1rem;
        color: var(--text-secondary);
        margin: 0;
        max-width: 500px;
      }

      /* FILTERS - Mobile Optimized */
      .filters {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 24px;
        /* Smooth scrolling for mobile */
        -webkit-overflow-scrolling: touch; 
      }

      .filter-pill {
        padding: 10px 18px;
        border: 1px solid var(--border);
        border-radius: 24px;
        background: var(--bg-card);
        color: var(--text-secondary);
        font-size: 0.75rem;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: all 0.2s ease;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        user-select: none;
      }

      /* Hover for Desktop only */
      @media (hover: hover) {
        .filter-pill:hover {
          background: var(--bg-hover);
          border-color: var(--accent);
          color: var(--text-primary);
        }
      }

      .filter-pill:active {
        transform: scale(0.96);
      }

      .filter-pill.active {
        background: var(--accent);
        border-color: var(--accent);
        color: #020308;
        box-shadow: 0 0 15px rgba(38, 181, 139, 0.4);
      }

      .filter-pill i {
        font-size: 1rem;
      }

      .filter-pill.active i {
        color: #020308;
      }

      /* SECTIONS */
      .section {
        margin-bottom: 60px;
      }
      
      .section.hidden-section {
          display: none !important;
      }

      .section-header {
        margin-bottom: 24px;
        padding-left: 4px;
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        flex-wrap: wrap;
        gap: 16px;
      }

      .section-header-text {
        flex: 1;
        min-width: 200px;
      }

      .section-title {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-primary);
        margin: 0 0 6px;
        letter-spacing: -0.02em;
      }

      .section-subtitle {
        font-size: 0.95rem;
        color: var(--text-tertiary);
        margin: 0;
      }

      .section-sort-pills {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .sort-pill {
        padding: 8px 14px;
        border: 1px solid var(--border);
        border-radius: 16px;
        background: var(--bg-card);
        color: var(--text-secondary);
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
        user-select: none;
      }

      .sort-pill.active {
        background: var(--accent);
        border-color: var(--accent);
        color: #020308;
      }

      .video-row-shell {
        position: relative;
        display: block;
      }
      
      /* MAIN VIDEO GRID */
      .video-row {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 24px;
        padding: 4px;
      }

      /* SHORTS SCROLLER */
      .video-row.shorts-row {
        display: flex;
        overflow-x: auto;
        gap: 16px;
        grid-template-columns: none;
        scroll-behavior: smooth;
        -ms-overflow-style: none; /* IE */
        scrollbar-width: none; /* Firefox */
        padding-bottom: 20px;
        scroll-snap-type: x mandatory; 
        -webkit-overflow-scrolling: touch; /* iOS Momentum */
      }
      
      .video-row.shorts-row::-webkit-scrollbar {
        display: none;
      }
      
      .video-row.shorts-row .video-card {
        min-width: calc((100% - 96px) / 7); 
        width: calc((100% - 96px) / 7);
        flex-shrink: 0;
        scroll-snap-align: start; 
      }

      /* ARROWS */
      .arrow-btn {
        display: none; /* Hidden by default, shown on hover via JS/CSS */
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        z-index: 10;
        background: rgba(19, 24, 36, 0.95);
        border: 1px solid var(--border);
        color: var(--accent);
        width: 48px;
        height: 48px;
        border-radius: 50%;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 4px 12px rgba(0,0,0,0.8);
      }
      
      /* Only show arrows on Desktop Hover */
      @media (hover: hover) {
        .video-row-shell:hover #shorts-prev, 
        .video-row-shell:hover #shorts-next {
            display: flex;
            opacity: 1;
        }
      }

      #shorts-prev { left: -24px; }
      #shorts-next { right: -24px; }

      /* VIDEO CARDS */
      .video-card {
        width: 100%;
        background: var(--bg-card);
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid rgba(31, 41, 55, 0.5);
        transition: border-color 0.2s ease, transform 0.1s ease;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        position: relative;
        height: 100%;
        -webkit-backface-visibility: hidden; /* Fix flickering */
      }

      /* Desktop Hover */
      @media (hover: hover) {
        .video-card:hover {
          border-color: var(--accent);
          box-shadow: 0 0 25px rgba(38, 181, 139, 0.15);
          z-index: 2;
        }
        .video-card:hover .overlay-icon {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1);
        }
        .video-card:hover .video-thumb img {
          opacity: 1;
          transform: scale(1.05);
        }
      }

      /* Mobile Active State (Tap) */
      .video-card:active {
        transform: scale(0.98);
        border-color: var(--accent);
      }

      .video-card.live-card {
        border-color: rgba(255, 68, 68, 0.3);
      }
      
      .video-thumb {
        position: relative;
        width: 100%;
        background: #0f1420;
        overflow: hidden;
        aspect-ratio: 16 / 9;
      }

      .video-thumb.ratio-shorts {
        aspect-ratio: 9 / 16; 
      }
      
      .duration-badge {
        position: absolute;
        bottom: 8px;
        right: 8px;
        background: rgba(0, 0, 0, 0.85);
        color: white;
        padding: 4px 6px;
        border-radius: 4px;
        font-size: 0.7rem;
        font-weight: 700;
        letter-spacing: 0.02em;
        pointer-events: none;
      }

      .stats-badge {
        position: absolute;
        top: 8px;
        right: 8px;
        background: rgba(0, 0, 0, 0.85);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.7rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 4px;
        pointer-events: none;
      }

      .video-thumb img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        transition: transform 0.4s ease;
        opacity: 0.95;
      }

      .overlay-icon {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.8);
        width: 54px;
        height: 54px;
        border-radius: 50%;
        background: rgba(38, 181, 139, 0.95);
        color: #000;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        opacity: 0;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        pointer-events: none;
      }
      
      .video-card.live-card .overlay-icon {
          background: rgba(255, 68, 68, 0.95);
      }

      .video-info {
        padding: 14px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        flex: 1;
        justify-content: space-between;
      }

      .video-title {
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--text-primary);
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        line-height: 1.35;
      }

      .video-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        font-size: 0.75rem;
        color: var(--text-tertiary);
        align-items: center;
      }
      
      .video-footer {
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-top: 6px;
      }

      .video-tag {
        display: inline-flex;
        padding: 4px 10px;
        background: rgba(38, 181, 139, 0.1);
        border: 1px solid rgba(38, 181, 139, 0.2);
        border-radius: 12px;
        color: var(--accent);
        font-weight: 700;
        font-size: 0.65rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        white-space: nowrap;
      }

      .video-tag.short-tag {
        background: rgba(240, 199, 106, 0.1);
        border-color: rgba(240, 199, 106, 0.2);
        color: var(--gold);
      }

      .video-tag.live-tag {
        background: var(--live-bg);
        border-color: rgba(255, 68, 68, 0.3);
        color: var(--live-red);
      }

      .status-msg {
        font-size: 0.9rem;
        color: var(--text-tertiary);
        margin-top: 12px;
        padding-left: 4px;
      }

      /* LIGHTBOX - IMPROVED DESIGN */
      .lightbox {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.98); /* Darker for better focus */
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
        padding: 40px;
      }

      .lightbox.active {
        opacity: 1;
        pointer-events: auto;
      }

      .lightbox-content-wrapper {
        position: relative;
        width: 100%;
        max-width: 1100px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        /* Scroll content if tall */
        max-height: 95vh;
      }

      .lightbox-video-container {
        position: relative;
        width: 100%;
        background: #000;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 0 50px rgba(38, 181, 139, 0.1);
        border: 1px solid rgba(38, 181, 139, 0.2);
        aspect-ratio: 16 / 9;
        flex-shrink: 0;
      }

      .lightbox-video-container.short-mode {
        max-width: 450px;
        aspect-ratio: 9 / 16;
        margin: 0 auto; /* Center shorts */
      }

      .lightbox-iframe {
        width: 100%;
        height: 100%;
        border: none;
      }

      /* Lightbox Details Section */
      .lightbox-details {
        color: var(--text-primary);
        padding: 8px 4px;
        animation: fadeIn 0.5s ease 0.2s backwards;
        overflow-y: auto;
      }

      .lightbox-header {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 12px;
      }

      .lightbox-title {
        font-size: 1.5rem;
        font-weight: 700;
        line-height: 1.3;
        margin: 0;
      }
      
      /* ACTION BUTTONS */
      .action-buttons {
          display: flex;
          gap: 10px;
          margin-top: 4px;
      }
      
      .action-btn {
          display: inline-flex;
          align-items: center;
          gap: 8px;
          padding: 8px 16px;
          border-radius: 20px;
          font-size: 0.85rem;
          font-weight: 600;
          text-decoration: none;
          transition: all 0.2s;
          border: 1px solid transparent;
      }
      
      .action-btn.youtube {
          background: #ff0000;
          color: white;
      }
      
      .action-btn.youtube:hover {
          background: #cc0000;
      }
      
      .action-btn.channel {
          background: rgba(255,255,255,0.1);
          color: var(--text-primary);
          border-color: rgba(255,255,255,0.1);
      }
      
      .action-btn.channel:hover {
          background: rgba(255,255,255,0.2);
      }

      .lightbox-meta-row {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 8px;
        color: var(--text-secondary);
        font-size: 0.95rem;
        margin-bottom: 16px;
      }

      .meta-divider {
        color: var(--text-tertiary);
      }

      .channel-name {
        color: var(--accent-light);
        font-weight: 600;
      }

      .lightbox-description {
        font-size: 0.95rem;
        color: var(--text-secondary);
        line-height: 1.6;
        max-width: 800px;
        white-space: pre-wrap; /* Preserve line breaks */
        display: -webkit-box;
        -webkit-line-clamp: 3; /* Limit initially */
        -webkit-box-orient: vertical;
        overflow: hidden;
        transition: all 0.3s;
      }
      
      .lightbox-description.expanded {
          -webkit-line-clamp: unset;
      }
      
      .read-more-btn {
          color: var(--accent);
          font-size: 0.9rem;
          font-weight: 600;
          margin-top: 6px;
          cursor: pointer;
          display: inline-block;
          background: none;
          border: none;
          padding: 0;
      }
      
      .read-more-btn:hover {
          text-decoration: underline;
      }

      .lightbox-close {
        position: absolute;
        top: -60px;
        right: 0;
        background: rgba(255,255,255,0.1);
        border: 1px solid rgba(255,255,255,0.1);
        width: 44px;
        height: 44px;
        border-radius: 50%;
        color: #fff;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
        z-index: 100;
      }

      .lightbox-close:hover {
        background: var(--accent);
        border-color: var(--accent);
        color: #000;
      }
      
      /* Lightbox Navigation Arrows */
      .lightbox-nav-btn {
          position: absolute;
          top: 50%;
          transform: translateY(-50%);
          background: rgba(0,0,0,0.5);
          color: white;
          border: 1px solid rgba(255,255,255,0.1);
          width: 48px;
          height: 48px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          transition: all 0.2s;
          z-index: 101;
      }
      
      .lightbox-nav-btn:hover {
          background: var(--accent);
          color: black;
      }
      
      #lb-prev { left: -70px; }
      #lb-next { right: -70px; }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* LOAD MORE BUTTON */
      .load-more-btn {
        display: block;
        width: 100%;
        max-width: 300px;
        margin: 32px auto 0;
        padding: 16px 28px;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 30px;
        color: var(--text-secondary);
        font-size: 0.9rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: inherit;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .load-more-btn:active {
        transform: scale(0.97);
      }

      .load-more-btn.hidden {
        display: none;
      }

      /* SKELETONS */
      .skeleton {
        background: var(--bg-card);
        border-radius: 12px;
        border: 1px solid var(--border);
        width: 100%;
        aspect-ratio: 16/10;
        position: relative;
        overflow: hidden;
      }
      .skeleton::after {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.03), transparent);
        animation: shimmer 1.5s infinite;
        transform: translateX(-100%);
      }
      .skeleton.short { aspect-ratio: 9/16; }
      @keyframes shimmer { 100% { transform: translateX(100%); } }

      /* FOOTER */
      footer {
        border-top: 1px solid var(--border);
        padding: 40px 20px;
        text-align: center;
        color: var(--text-tertiary);
        font-size: 0.9rem;
        margin-top: 60px;
        background: var(--bg-dark);
      }

      /* ========================================= */
      /* MOBILE RESPONSIVENESS */
      /* ========================================= */
      
      @media (max-width: 1280px) {
        .video-row { grid-template-columns: repeat(4, 1fr); }
      }
      
      @media (max-width: 1024px) {
        main { padding: 40px 20px; }
        .hero-text h1 { font-size: 3rem; }
        .video-row { grid-template-columns: repeat(3, 1fr); }
        
        #lb-prev { left: 10px; }
        #lb-next { right: 10px; }
      }

      @media (max-width: 768px) {
        .video-row { grid-template-columns: repeat(2, 1fr); }
        .hero-section { flex-direction: column; }
        .hero-text h1 { font-size: 2.5rem; }
      }

      @media (max-width: 640px) {
        main { padding: 20px 16px; }
        
        .header { padding: 12px 0; }
        .header-inner { padding: 0 16px; }
        .brand-icon { width: 28px; height: 28px; font-size: 0.9rem; }
        .brand-name { font-size: 1.3rem; }
        /* Hide text part of header info on small screens */
        .header-info .info-pill:first-child { display: none; } 
        
        .hero-text h1 { font-size: 2rem; margin-bottom: 12px; }
        .hero-text p { font-size: 1rem; }
        
        /* Better Filter Scroll */
        .filters {
            flex-wrap: nowrap;
            overflow-x: auto;
            margin-left: -16px; /* Bleed to edge */
            margin-right: -16px;
            padding-left: 16px;
            padding-right: 16px;
            padding-bottom: 12px;
            /* Hide Scrollbar */
            -ms-overflow-style: none;
            scrollbar-width: none;
            mask-image: linear-gradient(to right, black 95%, transparent 100%);
            -webkit-mask-image: linear-gradient(to right, black 95%, transparent 100%);
        }
        .filters::-webkit-scrollbar { display: none; }
        .filter-pill { flex-shrink: 0; }

        .section-title { font-size: 1.6rem; }
        
        /* 1 Column Layout on Mobile */
        .video-row { 
            grid-template-columns: 1fr; 
            gap: 20px;
        }
        
        /* Cards: Remove hover pop, retain border glow */
        .video-card { transform: none !important; }
        .video-card:hover { transform: none; box-shadow: none; }
        
        /* Shorts Scroller - Peek Effect */
        .video-row.shorts-row {
            margin-left: -16px;
            margin-right: -16px;
            padding-left: 16px;
            padding-right: 16px;
        }
        .video-row.shorts-row .video-card {
            min-width: 140px; 
            width: 140px; 
        }

        /* LIGHTBOX MOBILE OPTIMIZATION */
        .lightbox { 
            padding: 0; 
            background: #000; /* Full black immersive */
            align-items: flex-start; /* Start from top */
        }
        
        .lightbox-content-wrapper {
            height: 100%;
            max-height: 100%;
            justify-content: flex-start; /* Push to top */
            gap: 0;
            overflow-y: auto; /* Allow scrolling content */
            -webkit-overflow-scrolling: touch;
        }

        .lightbox-video-container {
            width: 100%;
            border-radius: 0;
            border: none;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .lightbox-video-container.short-mode {
            max-width: 100%;
            aspect-ratio: 9 / 16;
            margin: 0;
        }
        
        .lightbox-details {
            padding: 20px 16px 80px 16px; /* Extra bottom padding for safe area */
        }
        
        .lightbox-title {
            font-size: 1.2rem;
        }
        
        /* New Mobile Close Button - Fixed Bottom Center */
        .lightbox-close {
            top: auto;
            bottom: 30px;
            right: 50%;
            transform: translateX(50%);
            width: 50px;
            height: 50px;
            background: rgba(20, 20, 20, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            position: fixed; /* Fixed over scroll */
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        
        .lightbox-close i {
            font-size: 1.2rem;
        }
        
        /* Mobile Nav Buttons - Overlay on Video */
        .lightbox-nav-btn {
            width: 40px;
            height: 40px;
            background: rgba(0,0,0,0.3);
            border: none;
            top: 30%; /* Higher up */
        }
        #lb-prev { left: 10px; }
        #lb-next { right: 10px; }
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="header-inner">
        <div class="brand">
          <div class="brand-icon">TR</div>
          <div class="brand-name">TUBERAIDER</div>
        </div>
        <div class="header-info">
          <div class="info-pill">
            <i class="ph ph-compass"></i> Tomb Raider only
          </div>
          <div class="info-pill" id="header-updated">
            <i class="ph ph-clock"></i> Just now
          </div>
        </div>
      </div>
    </header>
    <main>
      <div class="hero-section">
        <div class="hero-text">
          <h1>TubeRaider</h1>
          <p>Discover the latest walkthroughs, trailers, speedruns, and content from the Tomb Raider universe.</p>
          <div class="filters" id="filters"></div>
        </div>
      </div>
      
      <!-- MOST VIEWED -->
      <section class="section" id="section-most-viewed">
        <div class="section-header">
          <div class="section-header-text">
            <h2 class="section-title">Most Viewed</h2>
            <p class="section-subtitle">Top videos from the archive</p>
          </div>
          <div class="section-sort-pills" id="most-viewed-sort">
            <button class="sort-pill active" data-timeframe="allTime">All Time</button>
            <button class="sort-pill" data-timeframe="month">This Month</button>
            <button class="sort-pill" data-timeframe="week">This Week</button>
            <button class="sort-pill" data-timeframe="today">Today</button>
          </div>
        </div>
        <div class="video-row-shell">
          <button class="arrow-btn" id="most-viewed-prev"><i class="ph ph-caret-left"></i></button>
          <div class="video-row" id="most-viewed-container"></div>
          <button class="arrow-btn" id="most-viewed-next"><i class="ph ph-caret-right"></i></button>
        </div>
        <button class="load-more-btn hidden" id="most-viewed-load-more">Load More</button>
        <div class="status-msg" id="most-viewed-status"></div>
      </section>

      <!-- TRENDING -->
      <section class="section" id="section-trending">
        <div class="section-header">
          <div class="section-header-text">
            <h2 class="section-title">Trending</h2>
            <p class="section-subtitle">What's popular right now</p>
          </div>
          <div class="section-sort-pills" id="trending-sort">
            <button class="sort-pill active" data-timeframe="week">This Week</button>
            <button class="sort-pill" data-timeframe="today">Today</button>
          </div>
        </div>
        <div class="video-row-shell">
          <button class="arrow-btn" id="trending-prev"><i class="ph ph-caret-left"></i></button>
          <div class="video-row" id="trending-container"></div>
          <button class="arrow-btn" id="trending-next"><i class="ph ph-caret-right"></i></button>
        </div>
        <button class="load-more-btn hidden" id="trending-load-more">Load More</button>
        <div class="status-msg" id="trending-status"></div>
      </section>

      <!-- LIVE -->
      <section class="section" id="section-live">
        <div class="section-header">
          <div class="section-header-text">
            <h2 class="section-title">Live Now</h2>
            <p class="section-subtitle">Ongoing streams and premieres</p>
          </div>
        </div>
        <div class="video-row-shell">
          <button class="arrow-btn" id="live-prev"><i class="ph ph-caret-left"></i></button>
          <div class="video-row" id="live-container"></div>
          <button class="arrow-btn" id="live-next"><i class="ph ph-caret-right"></i></button>
        </div>
        <button class="load-more-btn hidden" id="live-load-more">Load More</button>
        <div class="status-msg" id="live-status"></div>
      </section>

      <!-- LATEST -->
      <section class="section" id="section-latest">
        <div class="section-header">
          <div class="section-header-text">
            <h2 class="section-title">Latest</h2>
            <p class="section-subtitle">Fresh uploads</p>
          </div>
        </div>
        <div class="video-row-shell">
          <button class="arrow-btn" id="new-prev"><i class="ph ph-caret-left"></i></button>
          <div class="video-row" id="new-container"></div>
          <button class="arrow-btn" id="new-next"><i class="ph ph-caret-right"></i></button>
        </div>
        <button class="load-more-btn hidden" id="new-load-more">Load More</button>
        <div class="status-msg" id="new-status"></div>
      </section>

      <!-- SHORTS -->
      <section class="section" id="section-shorts">
        <div class="section-header">
          <div class="section-header-text">
            <h2 class="section-title">Shorts</h2>
            <p class="section-subtitle">Quick clips</p>
          </div>
          <div class="section-sort-pills" id="shorts-sort">
            <button class="sort-pill active" data-sort="latest">Latest</button>
            <button class="sort-pill" data-sort="popular">Popular</button>
          </div>
        </div>
        <div class="video-row-shell">
          <button class="arrow-btn" id="shorts-prev"><i class="ph ph-caret-left"></i></button>
          <div class="video-row shorts-row" id="shorts-container"></div>
          <button class="arrow-btn" id="shorts-next"><i class="ph ph-caret-right"></i></button>
        </div>
        <div class="status-msg" id="shorts-status"></div>
      </section>
    </main>
    <footer>
      <p>Â© 2025 TubeRaider â€” Curated Tomb Raider content</p>
    </footer>

    <!-- LIGHTBOX -->
    <div id="lightbox" class="lightbox">
      <button class="lightbox-nav-btn" id="lb-prev"><i class="ph ph-caret-left"></i></button>
      <div class="lightbox-content-wrapper" id="lightbox-wrapper">
          <!-- Content Injected via JS -->
      </div>
      <button class="lightbox-nav-btn" id="lb-next"><i class="ph ph-caret-right"></i></button>
      <button class="lightbox-close" id="lightbox-close">
        <i class="ph ph-x"></i>
      </button>
    </div>

    <script>
      const MOST_VIEWED_CONTAINER = document.getElementById("most-viewed-container");
      const TRENDING_CONTAINER = document.getElementById("trending-container");
      const LIVE_CONTAINER = document.getElementById("live-container");
      const NEW_CONTAINER = document.getElementById("new-container");
      const SHORTS_CONTAINER = document.getElementById("shorts-container");
      
      const MOST_VIEWED_STATUS = document.getElementById("most-viewed-status");
      const TRENDING_STATUS = document.getElementById("trending-status");
      const LIVE_STATUS = document.getElementById("live-status");
      const NEW_STATUS = document.getElementById("new-status");
      const SHORTS_STATUS = document.getElementById("shorts-status");
      
      const MOST_VIEWED_LOAD_MORE = document.getElementById("most-viewed-load-more");
      const TRENDING_LOAD_MORE = document.getElementById("trending-load-more");
      const LIVE_LOAD_MORE = document.getElementById("live-load-more");
      const NEW_LOAD_MORE = document.getElementById("new-load-more");
      
      const SEC_MOST_VIEWED = document.getElementById("section-most-viewed");
      const SEC_TRENDING = document.getElementById("section-trending");
      const SEC_LIVE = document.getElementById("section-live");
      const SEC_LATEST = document.getElementById("section-latest");
      const SEC_SHORTS = document.getElementById("section-shorts");

      const filtersEl = document.getElementById("filters");
      const headerUpdated = document.getElementById("header-updated");
      
      const lightbox = document.getElementById("lightbox");
      const lightboxWrapper = document.getElementById("lightbox-wrapper");
      const lightboxClose = document.getElementById("lightbox-close");
      const lbPrev = document.getElementById("lb-prev");
      const lbNext = document.getElementById("lb-next");
      
      let dataStore = {
        mostViewed: { today: [], week: [], month: [], allTime: [] },
        trending: { today: [], week: [] },
        newest: [],
        live: [],
        updated: null
      };
      
      let sortState = {
        mostViewed: 'allTime',
        trending: 'week',
        shorts: 'latest'
      };
      
      let loadMoreState = {
        mostViewed: 10,
        trending: 10,
        live: 10,
        newest: 10,
        shorts: 20
      };
      
      let activeFilter = "all";
      const filterOrder = ["all", "live", "walkthrough", "review", "ost", "trailer", "remaster", "speedrun"];
      const filterMeta = {
        all: { label: "All", icon: "ph-sparkle" },
        live: { label: "Live", icon: "ph-broadcast" },
        walkthrough: { label: "Walkthroughs", icon: "ph-game-controller" },
        review: { label: "Reviews", icon: "ph-star" },
        ost: { label: "Soundtracks", icon: "ph-music-note" },
        trailer: { label: "Trailers", icon: "ph-film-strip" },
        remaster: { label: "Remasters", icon: "ph-magic-wand" },
        speedrun: { label: "Speedruns", icon: "ph-lightning" }
      };

      // CLASSIFICATION LOGIC
      function titleAndDescription(video) {
        const title = (video.snippet && video.snippet.title) || "";
        const description = (video.snippet && video.snippet.description) || "";
        return (title + " " + description).toLowerCase();
      }

      function getDurationInSeconds(duration) {
        if (!duration) return 0;
        const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
        if (!match) return 0;
        const hours = parseInt(match[1]) || 0;
        const minutes = parseInt(match[2]) || 0;
        const seconds = parseInt(match[3]) || 0;
        return hours * 3600 + minutes * 60 + seconds;
      }

      function classifyVideo(video, checkAspectRatio = false) {
        const t = titleAndDescription(video);
        const tags = (video.snippet && video.snippet.tags) ? video.snippet.tags.map(tag => tag.toLowerCase()) : [];
        const duration = getDurationInSeconds(video.contentDetails && video.contentDetails.duration);
        
        const hasTag = (word) => tags.includes(word.toLowerCase());
        const hasWord = (word) => new RegExp(`\\b${word}\\b`, 'i').test(t);
        const hasPhrase = (phrase) => t.includes(phrase); 
        
        if (t.includes("#shorts") || t.includes(" shorts") || t.includes("ytshorts") || video._isShort) return "shorts";
        
        // Strict duration for shorts
        if (duration > 0 && duration < 120) return "shorts";

        // Live
        if (video.snippet && (video.snippet.liveBroadcastContent === 'live' || video.snippet.liveBroadcastContent === 'upcoming')) return "live";
        if (t.includes("ðŸ”´") || t.includes("live now") || t.includes("[live]")) return "live";

        // Categories
        if (hasTag("soundtrack") || hasTag("ost") || hasWord("ost") || hasPhrase("official score")) return "ost";
        if ((hasTag("trailer") || hasWord("trailer") || hasWord("teaser")) && duration < 300) return "trailer";
        if (hasTag("speedrun") || hasWord("speedrun") || hasPhrase("speed run")) return "speedrun";
        if (hasTag("walkthrough") || hasTag("longplay") || hasWord("walkthrough") || hasWord("longplay") || hasPhrase("let's play")) return "walkthrough";
        if (hasTag("review") || hasWord("review") || hasWord("critique") || hasPhrase("video essay") || hasWord("analysis")) return "review";
        if (hasTag("remaster") || hasTag("remastered") || hasWord("remaster") || hasWord("remastered")) return "remaster";

        return "other";
      }

      function passesFilter(video, isShortSection) {
        const tag = classifyVideo(video);
        if (isShortSection) return tag === "shorts";
        if (tag === "shorts") return false;
        if (activeFilter === "all") return true;
        return tag === activeFilter;
      }

      // UI BUILDERS
      function buildFilters() {
        filtersEl.innerHTML = "";
        const tagSet = new Set(['all']);
        const all = [...(dataStore.mostViewed.today || []), ...(dataStore.mostViewed.week || []), ...(dataStore.mostViewed.allTime || []), ...dataStore.newest, ...dataStore.live];
        
        all.forEach(video => {
          const tag = classifyVideo(video);
          if (tag !== "other") tagSet.add(tag);
        });
        
        filterOrder.forEach(key => {
          if (!tagSet.has(key)) return;
          const meta = filterMeta[key];
          const btn = document.createElement("button");
          btn.className = "filter-pill";
          if (key === activeFilter) btn.classList.add("active");
          btn.dataset.filter = key;
          btn.innerHTML = `<i class="ph ${meta.icon}"></i>${meta.label}`;
          filtersEl.appendChild(btn);
        });
      }

      filtersEl.addEventListener("click", (event) => {
        const btn = event.target.closest(".filter-pill");
        if (!btn) return;
        activeFilter = btn.dataset.filter || "all";
        [...filtersEl.querySelectorAll(".filter-pill")].forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        renderAll(true);
      });

      // FORMATTERS
      function formatViewCount(count) {
        if (!count) return "0";
        const num = parseInt(count);
        if (num >= 1000000) return (num / 1000000).toFixed(1) + "M";
        if (num >= 1000) return (num / 1000).toFixed(1) + "K";
        return num.toString();
      }

      function formatDate(dateString) {
          if(!dateString) return "";
          return new Date(dateString).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
      }

      function parseDuration(duration) {
        if (!duration) return null;
        const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
        if (!match) return null;
        const hours = parseInt(match[1]) || 0;
        const minutes = parseInt(match[2]) || 0;
        const seconds = parseInt(match[3]) || 0;
        return hours > 0 
            ? `${hours}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`
            : `${minutes}:${String(seconds).padStart(2, '0')}`;
      }

      // RENDERING
      function showSkeletons() {
        [MOST_VIEWED_CONTAINER, TRENDING_CONTAINER, LIVE_CONTAINER, NEW_CONTAINER].forEach(c => {
          c.innerHTML = "";
          for (let i = 0; i < 5; i++) {
            const sk = document.createElement("div");
            sk.className = "skeleton";
            c.appendChild(sk);
          }
        });
        SHORTS_CONTAINER.innerHTML = "";
        for (let i = 0; i < 5; i++) {
          const sk = document.createElement("div");
          sk.className = "skeleton short";
          SHORTS_CONTAINER.appendChild(sk);
        }
      }

      function renderRow(videos, container, statusEl, loadMoreBtn, sectionKey, isShortSection, isLiveSection = false, sectionEl = null) {
        const prevScrollLeft = isShortSection ? container.scrollLeft : 0;
        container.innerHTML = "";
        
        let filtered;
        if (isShortSection) {
          filtered = videos; 
        } else if (isLiveSection) {
          filtered = videos.filter(v => classifyVideo(v) === "live");
        } else {
          filtered = videos.filter(v => {
            const tag = classifyVideo(v);
            if (tag === "shorts" || tag === "live") return false;
            return passesFilter(v, false);
          });
        }

        if (!filtered || filtered.length === 0) {
          if (activeFilter !== 'all' && sectionEl) {
              sectionEl.classList.add('hidden-section');
          } else {
              statusEl.textContent = isLiveSection ? "No live streams." : "No videos found.";
              if(sectionEl) sectionEl.classList.remove('hidden-section');
          }
          if(loadMoreBtn) loadMoreBtn.classList.add('hidden');
          return;
        }
        
        if (sectionEl) sectionEl.classList.remove('hidden-section');
        statusEl.textContent = "";
        
        const limit = loadMoreState[sectionKey];
        const videosToShow = filtered.slice(0, limit);
        const hasMore = filtered.length > limit;
        
        videosToShow.forEach((video, index) => {
          const videoId = typeof video.id === 'string' ? video.id : (video.id && video.id.videoId ? video.id.videoId : null);
          if (!videoId) return;
          
          const title = video.snippet?.title || "Untitled";
          const channel = video.snippet?.channelTitle || "";
          const publishedDate = formatDate(video.snippet?.publishedAt);
          const tag = classifyVideo(video);
          const isShort = isShortSection || tag === "shorts";
          const isLive = tag === "live";
          
          const card = document.createElement("div");
          card.className = "video-card" + (isShort ? " short" : "") + (isLive ? " live-card" : "");
          // Pass index and full list for navigation
          card.onclick = () => openLightbox(index, videosToShow);
          
          const thumbClass = isShort ? "video-thumb ratio-shorts" : "video-thumb ratio-16x9";
          const tagClass = tag === "live" ? "live-tag" : (isShort ? "short-tag" : "");
          
          const viewCount = formatViewCount(video.statistics?.viewCount);
          const duration = parseDuration(video.contentDetails?.duration);
          
          card.innerHTML = `
            <div class="${thumbClass}">
                <img src="https://i.ytimg.com/vi/${videoId}/hqdefault.jpg" loading="lazy" alt="">
                ${viewCount !== "0" ? `<div class="stats-badge"><i class="ph ph-eye"></i>${viewCount}</div>` : ''}
                ${duration ? `<div class="duration-badge">${duration}</div>` : ''}
                <div class="overlay-icon"><i class="ph-fill ph-play"></i></div>
            </div>
            <div class="video-info">
                <div class="video-text-group">
                    <div class="video-title">${title}</div>
                    <div class="video-meta">
                        <span>${channel}</span>
                        ${publishedDate ? `<span>â€¢</span><span>${publishedDate}</span>` : ''}
                    </div>
                </div>
                <div class="video-footer">
                    <div class="video-tag ${tagClass}">${tagLabel(tag)}</div>
                </div>
            </div>
          `;
          container.appendChild(card);
        });
        
        if (loadMoreBtn) {
            if (hasMore) loadMoreBtn.classList.remove('hidden');
            else loadMoreBtn.classList.add('hidden');
        }
        
        if (isShortSection) container.scrollLeft = prevScrollLeft;
      }

      function tagLabel(tag) {
        const labels = { live: "Live", walkthrough: "Walkthrough", review: "Review", ost: "Soundtrack", trailer: "Trailer", remaster: "Remaster", speedrun: "Speedrun", shorts: "Short", other: "Other" };
        return labels[tag] || "Other";
      }

      function renderAll(reset = false) {
        if (reset) {
          loadMoreState = { mostViewed: 10, trending: 10, live: 10, newest: 10, shorts: 20 };
        }
        
        let rawMostViewed = dataStore.mostViewed[sortState.mostViewed] || [];
        if (sortState.mostViewed === 'allTime') {
            const combined = [...rawMostViewed, ...dataStore.newest];
            const seen = new Set();
            rawMostViewed = combined.filter(v => {
                const id = typeof v.id === 'string' ? v.id : (v.id && v.id.videoId ? v.id.videoId : null);
                if (!id || seen.has(id)) return false;
                seen.add(id);
                return true;
            }).sort((a, b) => (parseInt(b.statistics?.viewCount || 0) - parseInt(a.statistics?.viewCount || 0)));
        }
        
        let shortsOnly = [...dataStore.mostViewed.allTime, ...dataStore.newest].filter(v => classifyVideo(v) === "shorts");
        if (sortState.shorts === 'popular') {
            shortsOnly.sort((a, b) => (parseInt(b.statistics?.viewCount || 0) - parseInt(a.statistics?.viewCount || 0)));
        } else {
            shortsOnly.sort((a, b) => new Date(b.snippet?.publishedAt || 0) - new Date(a.snippet?.publishedAt || 0));
        }

        renderRow(rawMostViewed, MOST_VIEWED_CONTAINER, MOST_VIEWED_STATUS, MOST_VIEWED_LOAD_MORE, 'mostViewed', false, false, SEC_MOST_VIEWED);
        renderRow(dataStore.trending[sortState.trending] || [], TRENDING_CONTAINER, TRENDING_STATUS, TRENDING_LOAD_MORE, 'trending', false, false, SEC_TRENDING);
        renderRow(dataStore.live, LIVE_CONTAINER, LIVE_STATUS, LIVE_LOAD_MORE, 'live', false, true, SEC_LIVE);
        renderRow(dataStore.newest, NEW_CONTAINER, NEW_STATUS, NEW_LOAD_MORE, 'newest', false, false, SEC_LATEST);
        renderRow(shortsOnly, SHORTS_CONTAINER, SHORTS_STATUS, null, 'shorts', true, false, SEC_SHORTS);
      }

      // DATA FETCHING
      async function fetchVideos() {
        showSkeletons();
        const CACHE_KEY = 'tuberaider_data';
        const CACHE_DURATION = 1000 * 60 * 30; // 30 mins

        const cached = localStorage.getItem(CACHE_KEY);
        if (cached) {
          const parsed = JSON.parse(cached);
          if (new Date().getTime() - parsed.timestamp < CACHE_DURATION) {
            processData(parsed.data);
            return;
          }
        }

        try {
          const res = await fetch("https://tuberaider.tombraiderarchives.workers.dev/videos");
          if (!res.ok) throw new Error("API Error");
          const data = await res.json();
          
          try {
            localStorage.setItem(CACHE_KEY, JSON.stringify({ timestamp: new Date().getTime(), data: data }));
          } catch(e) {}
          
          processData(data);
        } catch (e) {
          console.error(e);
          [MOST_VIEWED_STATUS, TRENDING_STATUS, LIVE_STATUS, NEW_STATUS, SHORTS_STATUS].forEach(el => {
             el.classList.add("error");
             el.textContent = "Could not load videos";
          });
        }
      }

      function processData(data) {
        dataStore = {
            mostViewed: data.mostViewed || { today: [], week: [], month: [], allTime: [] },
            trending: data.trending || { today: [], week: [] },
            newest: data.newest || [],
            live: data.live || [],
            updated: data.updated
        };
        // Pre-classify
        [...dataStore.newest, ...dataStore.live].forEach(v => classifyVideo(v, true));
        
        buildFilters();
        renderAll(true);
        if (data.updated) {
            headerUpdated.innerHTML = `<i class="ph ph-clock"></i>${new Date(data.updated).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
        }
      }

      // LIGHTBOX LOGIC - UPDATED TO SHOW DETAILS
      let currentLightboxList = [];
      let currentLightboxIndex = 0;

      function openLightbox(index, list) {
        // Push state for Android back button support
        history.pushState({modalOpen: true}, "Video", "#video");
        
        currentLightboxList = list;
        currentLightboxIndex = index;
        updateLightboxContent();
        
        lightbox.classList.add('active');
      }
      
      function updateLightboxContent() {
          const videoData = currentLightboxList[currentLightboxIndex];
          if (!videoData) return;
          
          const videoId = typeof videoData.id === 'string' ? videoData.id : (videoData.id && videoData.id.videoId ? videoData.id.videoId : null);
          const isShort = classifyVideo(videoData) === 'shorts';
          
          // Prepare data
          const title = videoData.snippet?.title || "Unknown Title";
          const channel = videoData.snippet?.channelTitle || "Unknown Channel";
          const channelId = videoData.snippet?.channelId || "";
          const views = formatViewCount(videoData.statistics?.viewCount) + " views";
          const date = formatDate(videoData.snippet?.publishedAt);
          // Fix indentation by using trim and ensuring no whitespace in variable
          const desc = (videoData.snippet?.description || "No description available.").trim();
          
          const videoClass = isShort ? "short-mode" : "";
          
          // INJECT HTML
          lightboxWrapper.innerHTML = `
              <div class="lightbox-video-container ${videoClass}">
                  <iframe class="lightbox-iframe" 
                      src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&playsinline=1" 
                      allowfullscreen allow="autoplay; encrypted-media; picture-in-picture">
                  </iframe>
              </div>
              
              <div class="lightbox-details">
                  <div class="lightbox-header">
                      <h3 class="lightbox-title">${title}</h3>
                      <div class="action-buttons">
                          <a href="https://www.youtube.com/watch?v=${videoId}" target="_blank" class="action-btn youtube">
                              <i class="ph-fill ph-youtube-logo"></i> Watch on YouTube
                          </a>
                          <a href="https://www.youtube.com/channel/${channelId}" target="_blank" class="action-btn channel">
                              <i class="ph-fill ph-user"></i> Visit Channel
                          </a>
                      </div>
                  </div>
                  
                  <div class="lightbox-meta-row">
                      <span class="channel-name">${channel}</span>
                      <span class="meta-divider">â€¢</span>
                      <span class="view-count">${views}</span>
                      <span class="meta-divider">â€¢</span>
                      <span class="upload-date">${date}</span>
                  </div>
                  
                  <div class="lightbox-description" id="lb-desc">${desc}</div>
                  <button class="read-more-btn" id="lb-readmore" onclick="toggleDesc()">Read more</button>
              </div>
          `;
          
          // Check description length to show/hide "Read more"
          setTimeout(() => {
              const descEl = document.getElementById('lb-desc');
              const btn = document.getElementById('lb-readmore');
              if(descEl && descEl.scrollHeight <= descEl.clientHeight) {
                  btn.style.display = 'none';
              }
          }, 100);
      }
      
      // Global function for the onclick
      window.toggleDesc = function() {
          const desc = document.getElementById('lb-desc');
          const btn = document.getElementById('lb-readmore');
          desc.classList.toggle('expanded');
          btn.textContent = desc.classList.contains('expanded') ? "Show less" : "Read more";
      }
      
      // Nav Functions
      lbPrev.addEventListener('click', (e) => {
          e.stopPropagation();
          if (currentLightboxIndex > 0) {
              currentLightboxIndex--;
              updateLightboxContent();
          }
      });
      
      lbNext.addEventListener('click', (e) => {
          e.stopPropagation();
          if (currentLightboxIndex < currentLightboxList.length - 1) {
              currentLightboxIndex++;
              updateLightboxContent();
          }
      });

      function closeLightbox() {
        lightbox.classList.remove('active');
        // Clear history state if we are closing manually
        if (history.state && history.state.modalOpen) {
             history.back();
        }
        setTimeout(() => { lightboxWrapper.innerHTML = ""; }, 300);
      }
      
      // Handle Back Button
      window.onpopstate = function(event) {
          if (lightbox.classList.contains('active')) {
              lightbox.classList.remove('active');
              setTimeout(() => { lightboxWrapper.innerHTML = ""; }, 300);
          }
      };

      lightboxClose.addEventListener("click", () => {
          // Manually triggering close needs to handle history carefully
          if (history.state && history.state.modalOpen) {
              history.back(); // This will trigger onpopstate which closes it
          } else {
              closeLightbox(); // Fallback
          }
      });
      
      lightbox.addEventListener("click", (e) => {
        if (e.target === lightbox || e.target === lightboxWrapper) {
             if (history.state && history.state.modalOpen) history.back();
             else closeLightbox();
        }
      });

      // EVENT LISTENERS
      const sortConfigs = [
        { key: 'mostViewed', id: 'most-viewed-sort' },
        { key: 'trending', id: 'trending-sort' },
        { key: 'shorts', id: 'shorts-sort' }
      ];

      sortConfigs.forEach(config => {
          const el = document.getElementById(config.id);
          if (el) {
              el.addEventListener('click', (e) => {
                 const pill = e.target.closest('.sort-pill');
                 if(!pill) return;
                 const type = pill.dataset.timeframe || pill.dataset.sort;
                 sortState[config.key] = type;
                 el.querySelectorAll('.sort-pill').forEach(p => p.classList.remove('active'));
                 pill.classList.add('active');
                 renderAll();
              });
          }
      });

      ['most-viewed', 'trending', 'live', 'new'].forEach(key => {
          const loadBtn = document.getElementById(`${key}-load-more`);
          if(loadBtn) loadBtn.addEventListener('click', () => handleLoadMore(key === 'new' ? 'newest' : (key === 'most-viewed' ? 'mostViewed' : key)));
      });

      function handleLoadMore(key) {
          loadMoreState[key] += 10;
          renderAll();
      }

      // Horizontal Scroll Buttons
      document.querySelectorAll('.video-row-shell').forEach(shell => {
          const container = shell.querySelector('.video-row');
          const prev = shell.querySelector('.arrow-btn:first-child');
          const next = shell.querySelector('.arrow-btn:last-child');
          
          if(prev && next && container) {
              prev.addEventListener('click', () => container.scrollBy({ left: -container.clientWidth, behavior: 'smooth' }));
              next.addEventListener('click', () => container.scrollBy({ left: container.clientWidth, behavior: 'smooth' }));
          }
      });

      fetchVideos();
    </script>
  </body>
</html>