<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Volumetric</title>
    
    <!-- iOS Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Volumetric">
    <meta name="theme-color" content="#000000">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --ios-bg: #000000;
            --ios-secondary: #1c1c1e;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        body {
            background-color: var(--ios-bg);
            color: #ffffff;
            overscroll-behavior: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Arial, sans-serif;
        }

        .app-container {
            padding-top: calc(var(--safe-top) + 1.5rem);
            padding-bottom: calc(var(--safe-bottom) + 2rem);
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .canvas-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            aspect-ratio: 1 / 1;
            margin: auto;
            border-radius: 3rem;
            overflow: hidden;
            background: #000;
            box-shadow: 0 0 0 0.5px rgba(255, 255, 255, 0.15);
            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .canvas-container:active {
            transform: scale(0.98);
        }

        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .ios-btn {
            background: var(--ios-secondary);
            color: #0A84FF; /* iOS System Blue */
            font-weight: 500;
            font-size: 17px;
            padding: 18px;
            border-radius: 14px;
            transition: background 0.2s, transform 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .ios-btn:active {
            background: #2c2c2e;
            transform: scale(0.97);
        }

        .ios-btn-primary {
            background: #ffffff;
            color: #000000;
            font-weight: 600;
        }

        .ios-btn-primary:active {
            background: #d1d1d6;
        }

        #loadingOverlay {
            position: absolute;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 10;
        }

        .ios-spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-top-color: #ffffff;
            border-radius: 50%;
            animation: ios-spin 0.8s linear infinite;
        }

        @keyframes ios-spin {
            to { transform: rotate(360deg); }
        }

        .status-pill {
            background: var(--ios-secondary);
            padding: 4px 12px;
            border-radius: 100px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.05em;
            color: #8e8e93;
            text-transform: uppercase;
        }
    </style>
</head>
<body class="overflow-hidden">

    <div class="app-container px-8">
        <!-- Minimal Header -->
        <header class="flex flex-col items-center gap-2">
            <span class="status-pill" id="themeLabel">Volumetric</span>
        </header>

        <!-- Main View -->
        <div class="canvas-container" id="mainCanvasGroup">
            <canvas id="gradientCanvas" width="1200" height="1200"></canvas>
            <div id="loadingOverlay">
                <div class="ios-spinner"></div>
            </div>
        </div>

        <!-- Single Action Footer -->
        <div class="flex flex-col gap-4">
            <button id="generateBtn" class="ios-btn ios-btn-primary">
                New Generation
            </button>
            
            <div class="flex justify-between items-center px-2">
                <button id="downloadBtn" class="text-[#0A84FF] text-[15px] font-medium active:opacity-50 transition-opacity">
                    Export Image
                </button>
                <div class="w-1.5 h-1.5 rounded-full bg-zinc-800"></div>
                <p class="text-[12px] text-zinc-600 font-medium">1.2MP â€¢ Deep Black</p>
            </div>
        </div>
    </div>

    <script>
        const THEMES = [
            { name: "Neon Dusk", colors: ['#ef4444', '#ec4899', '#a855f7', '#6366f1', '#4c1d95'], bg: '#000000' },
            { name: "Electric Ocean", colors: ['#06b6d4', '#007AFF', '#17A8FF', '#10b981', '#133F35'], bg: '#000000' },
            { name: "Solar Flare", colors: ['#F5C81E', '#ef4444', '#f97316', '#D97706', '#78350F'], bg: '#000000' },
            { name: "Cyber Violet", colors: ['#a855f7', '#6366f1', '#ec4899', '#3B356A', '#6C2D55'], bg: '#000000' },
            { name: "Midnight Rose", colors: ['#fb7185', '#e11d48', '#881337', '#4c0519', '#27272a'], bg: '#000000' }
        ];

        const canvas = document.getElementById('gradientCanvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true, alpha: false });
        const generateBtn = document.getElementById('generateBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const themeLabel = document.getElementById('themeLabel');
        const loadingOverlay = document.getElementById('loadingOverlay');

        let isGenerating = false;

        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return { r, g, b };
        }

        function drawGaussianGlow(x, y, radius, color, alpha) {
            const rgb = hexToRgb(color);
            const grad = ctx.createRadialGradient(x, y, 0, x, y, radius);
            
            const steps = 45; 
            for (let i = 0; i <= steps; i++) {
                const t = i / steps;
                const currentAlpha = alpha * Math.exp(-Math.pow(t * 2.1, 2));
                grad.addColorStop(t, `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${currentAlpha})`);
            }

            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, 1200, 1200);
        }

        function applyGlobalGrain() {
            const imageData = ctx.getImageData(0, 0, 1200, 1200);
            const data = imageData.data;
            const intensity = 7; 
            
            for (let i = 0; i < data.length; i += 4) {
                const noise = (Math.random() - 0.5) * intensity;
                data[i] += noise;
                data[i + 1] += noise;
                data[i + 2] += noise;
            }
            ctx.putImageData(imageData, 0, 0);
        }

        async function generate() {
            if (isGenerating) return;
            isGenerating = true;
            
            loadingOverlay.style.display = 'flex';

            // Ensure smooth transition
            await new Promise(r => requestAnimationFrame(() => setTimeout(r, 60)));

            const theme = THEMES[Math.floor(Math.random() * THEMES.length)];
            themeLabel.innerText = theme.name;
            
            const shuffledColors = [...theme.colors].sort(() => Math.random() - 0.5);

            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, 1200, 1200);

            // Large base glow
            drawGaussianGlow(600 + (Math.random()-0.5)*400, 600 + (Math.random()-0.5)*400, 900, shuffledColors[0], 0.18);

            // Structural blooms
            const offsetX = (Math.random() - 0.5) * 300;
            const offsetY = (Math.random() - 0.5) * 300;
            drawGaussianGlow(600 + offsetX, 600 + offsetY, 500, shuffledColors[1], 0.45);
            drawGaussianGlow(600 - offsetX, 600 - offsetY, 450, shuffledColors[2], 0.35);

            // Highlights
            for(let i=0; i<2; i++) {
                const hx = 600 + (Math.random() - 0.5) * 600;
                const hy = 600 + (Math.random() - 0.5) * 600;
                drawGaussianGlow(hx, hy, 200 + Math.random()*200, shuffledColors[3] || shuffledColors[0], 0.25);
            }

            applyGlobalGrain();

            isGenerating = false;
            loadingOverlay.style.display = 'none';
        }

        function download() {
            const dataUrl = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.download = `volumetric-${Date.now()}.png`;
            link.href = dataUrl;
            link.click();
            
            // Visual feedback
            canvas.style.opacity = '0.4';
            setTimeout(() => canvas.style.opacity = '1', 150);
        }

        window.addEventListener('load', () => {
            generate();
            document.addEventListener('touchmove', (e) => {
                if (e.touches.length > 1) e.preventDefault();
            }, { passive: false });
        });

        generateBtn.addEventListener('click', generate);
        downloadBtn.addEventListener('click', download);
        document.getElementById('mainCanvasGroup').addEventListener('click', generate);
    </script>
</body>
</html>