<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solid Studio Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom Font Face Mapping */
        @font-face {
            font-family: 'Circular';
            src: url('fonts/Circular/Circular-Black.ttf') format('truetype');
            font-weight: 900;
        }
        @font-face {
            font-family: 'Circular';
            src: url('fonts/Circular/Circular-Bold.ttf') format('truetype');
            font-weight: 700;
        }
        @font-face {
            font-family: 'Circular';
            src: url('fonts/Circular/Circular-Medium.ttf') format('truetype');
            font-weight: 500;
        }
        @font-face {
            font-family: 'Circular';
            src: url('fonts/Circular/Circular-Book.ttf') format('truetype');
            font-weight: 400;
        }
        
        body {
            font-family: 'Circular', -apple-system, sans-serif;
            background-color: #09090b;
            color: white;
            margin: 0;
            overflow: hidden;
        }

        .canvas-container {
            transition: transform 0.2s ease-out;
            transform-origin: center;
        }

        /* Custom Scrollbar for the Sidebar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #27272a;
            border-radius: 10px;
        }

        .color-dot-active {
            outline: 2px solid #3b82f6;
            outline-offset: 4px;
            transform: scale(0.85);
        }

        /* Toggle Switch Styling */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #3b82f6;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #3b82f6;
        }
    </style>
</head>
<body class="flex flex-col md:flex-row h-screen w-screen">

    <!-- Viewport Area -->
    <main id="viewport" class="flex-grow bg-[#050507] flex items-center justify-center relative overflow-hidden h-[50vh] md:h-full p-4 md:p-8">
        <div id="container" class="canvas-container relative bg-black shadow-2xl flex-shrink-0" style="width: 1000px; height: 1000px;">
            <canvas id="mainCanvas" width="1000" height="1000" class="w-full h-full block"></canvas>
        </div>
    </main>

    <!-- Sidebar Panel -->
    <aside class="w-full md:w-[400px] bg-[#121217] border-l border-white/5 p-6 md:p-8 flex flex-col gap-6 md:gap-8 overflow-y-auto shadow-2xl z-10 md:h-full h-[50vh]">
        <header class="border-b border-white/5 pb-4">
            <h1 class="text-xl md:text-2xl font-extrabold tracking-tighter bg-gradient-to-r from-white to-zinc-400 bg-clip-text text-transparent">
                Solid Studio Pro
            </h1>
        </header>

        <!-- Color Palette -->
        <section class="space-y-3">
            <div class="flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-zinc-500">
                <i data-lucide="palette" class="w-3.5 h-3.5"></i> Brand Palette
            </div>
            <div id="paletteGrid" class="bg-[#1c1c21] rounded-xl p-3 border border-white/5 grid grid-cols-6 gap-2">
                <!-- Dots injected via JS -->
            </div>
        </section>

        <!-- Overlays -->
        <section class="space-y-4">
            <div class="flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-zinc-500">
                <i data-lucide="layers" class="w-3.5 h-3.5"></i> Overlays
            </div>
            <div class="flex flex-col gap-3">
                <div class="flex items-center justify-between bg-[#1c1c21] p-3 rounded-xl border border-white/5">
                    <div class="flex flex-col">
                        <span class="text-sm font-medium">Shape Overlay</span>
                        <span id="shapeLabel" class="text-[10px] text-zinc-500 uppercase font-bold mt-0.5">Variant 01</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <button id="shuffleShapeBtn" class="p-2 hover:bg-white/5 rounded-lg transition-colors text-zinc-400 hover:text-white" title="Shuffle Shape Variant">
                            <i data-lucide="shuffle" class="w-4 h-4"></i>
                        </button>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="shapeToggle" class="sr-only peer">
                            <div class="w-11 h-6 bg-zinc-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                </div>
                <div class="flex items-center justify-between bg-[#1c1c21] p-3 rounded-xl border border-white/5">
                    <span class="text-sm font-medium">Frame Overlay</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="frameToggle" class="sr-only peer">
                        <div class="w-11 h-6 bg-zinc-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                    </label>
                </div>
            </div>
        </section>

        <!-- Content Input -->
        <section class="space-y-3">
            <div class="flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-zinc-500">
                <i data-lucide="type" class="w-3.5 h-3.5"></i> Typography Content
            </div>
            <textarea
                id="textInput"
                class="w-full bg-[#1c1c21] border border-white/5 rounded-xl p-4 text-base focus:border-blue-500 outline-none transition-all resize-none text-white font-inherit"
                rows="2"
            >Simple is the new premium.</textarea>
        </section>

        <!-- Font Weight -->
        <section class="space-y-3">
            <div class="text-[10px] font-bold uppercase tracking-widest text-zinc-500">Font Weight</div>
            <div class="relative">
                <select
                    id="weightInput"
                    class="w-full bg-[#1c1c21] border border-white/5 rounded-xl p-4 pr-10 appearance-none text-base outline-none focus:border-blue-500 transition-all cursor-pointer text-white"
                >
                    <option value="900">Circular Black</option>
                    <option value="700" selected>Circular Bold</option>
                    <option value="500">Circular Medium</option>
                    <option value="400">Circular Book</option>
                </select>
                <i data-lucide="chevron-down" class="absolute right-4 top-1/2 -translate-y-1/2 text-zinc-500 pointer-events-none w-4 h-4"></i>
            </div>
        </section>

        <!-- Primary Actions -->
        <div class="flex gap-3 mt-auto pt-6">
            <button
                id="downloadBtn"
                class="flex-1 bg-blue-600 hover:bg-blue-500 active:scale-95 transition-all rounded-xl p-4 font-bold flex items-center justify-center gap-2 shadow-lg shadow-blue-900/20"
            >
                <i data-lucide="download" class="w-4 h-4"></i> Export PNG
            </button>
            <button
                id="randomBtn"
                class="w-14 h-14 bg-white/5 hover:bg-white/10 active:scale-90 border border-white/5 transition-all rounded-xl flex items-center justify-center"
                title="Randomize Appearance"
            >
                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
            </button>
        </div>
    </aside>

    <script>
        // Constants
        const CANVAS_SIZE = 1000;
        
        // Base tailwind-like colors
        const BASE_PALETTE = [
            [100, 116, 139], [239, 68, 68], [249, 115, 22], [245, 158, 11], 
            [234, 179, 8], [34, 197, 94], [16, 185, 129], [20, 184, 166], 
            [6, 182, 212], [14, 165, 233], [59, 130, 246], [99, 102, 241]
        ];

        // Your requested hex colors
        const NEW_HEX_COLORS = [
            "#355B58", "#524A41", "#535647", "#5E3D5E",
            "#50525A", "#6A5645", "#6A6248", "#4B5D45",
            "#365567", "#53e14c", "#FA4E63", "#17A8FF",
            "#F5C81E", "#C24C2D", "#3B356A", "#6C2D55",
            "#9B4658", "#133F35"
        ];

        // State
        let activeColor = [59, 130, 246];
        let activeShapeIndex = "01";
        const allColors = [];
        const images = {};

        // Elements
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('container');
        const viewport = document.getElementById('viewport');
        const textInput = document.getElementById('textInput');
        const weightInput = document.getElementById('weightInput');
        const paletteGrid = document.getElementById('paletteGrid');
        const downloadBtn = document.getElementById('downloadBtn');
        const randomBtn = document.getElementById('randomBtn');
        const shuffleShapeBtn = document.getElementById('shuffleShapeBtn');
        const shapeToggle = document.getElementById('shapeToggle');
        const frameToggle = document.getElementById('frameToggle');
        const shapeLabel = document.getElementById('shapeLabel');

        // Utils
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? [
                parseInt(result[1], 16),
                parseInt(result[2], 16),
                parseInt(result[3], 16)
            ] : null;
        }

        function initColors() {
            // Add Base Colors with variants
            BASE_PALETTE.forEach(([r, g, b]) => {
                const adjust = (v, f) => Math.min(255, Math.max(0, Math.round(v * f)));
                allColors.push([r, g, b]);
            });

            // Add Requested Hex Colors
            NEW_HEX_COLORS.forEach(hex => {
                const rgb = hexToRgb(hex);
                if (rgb) allColors.push(rgb);
            });

            // Create buttons
            allColors.forEach(rgb => {
                const btn = document.createElement('button');
                btn.className = 'aspect-square rounded-md transition-all duration-200 hover:scale-110';
                btn.style.backgroundColor = `rgb(${rgb.join(',')})`;
                btn.onclick = () => {
                    activeColor = rgb;
                    updateActiveDot();
                    render();
                };
                paletteGrid.appendChild(btn);
            });
            updateActiveDot();
        }

        async function preloadImages() {
            const paths = {
                'shape_01': 'overlay/shape_01.png',
                'shape_02': 'overlay/shape_02.png',
                'shape_03': 'overlay/shape_03.png',
                'frame': 'overlay/frame.png'
            };

            const load = (key, src) => new Promise(resolve => {
                const img = new Image();
                img.onload = () => { images[key] = img; resolve(); };
                img.onerror = () => { console.warn(`Missing asset: ${src}`); resolve(); };
                img.src = src;
            });

            await Promise.all(Object.entries(paths).map(([k, v]) => load(k, v)));
        }

        function updateActiveDot() {
            const btns = paletteGrid.querySelectorAll('button');
            btns.forEach((btn, i) => {
                if (JSON.stringify(allColors[i]) === JSON.stringify(activeColor)) {
                    btn.classList.add('color-dot-active');
                } else {
                    btn.classList.remove('color-dot-active');
                }
            });
        }

        function updateScale() {
            const padding = window.innerWidth < 768 ? 20 : 60;
            const vWidth = viewport.clientWidth - padding;
            const vHeight = viewport.clientHeight - padding;
            const scale = Math.min(vWidth / CANVAS_SIZE, vHeight / CANVAS_SIZE);
            container.style.transform = `scale(${scale})`;
        }

        function render() {
            const text = textInput.value;
            const weight = weightInput.value;

            // 1. Background Color
            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = `rgb(${activeColor.join(',')})`;
            ctx.fillRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);

            // 2. Overlays
            ctx.globalCompositeOperation = 'overlay';
            
            if (shapeToggle.checked && images[`shape_${activeShapeIndex}`]) {
                ctx.drawImage(images[`shape_${activeShapeIndex}`], 0, 0, CANVAS_SIZE, CANVAS_SIZE);
            }
            
            if (frameToggle.checked && images['frame']) {
                ctx.drawImage(images['frame'], 0, 0, CANVAS_SIZE, CANVAS_SIZE);
            }

            // 3. Text
            ctx.globalCompositeOperation = 'source-over';
            
            const brightness = (activeColor[0] * 299 + activeColor[1] * 587 + activeColor[2] * 114) / 1000;
            ctx.fillStyle = brightness > 185 ? '#000000' : '#ffffff';

            ctx.font = `${weight} 90px "Circular", -apple-system, sans-serif`;
            ctx.textAlign = 'left';
            ctx.textBaseline = 'top';

            const maxWidth = 760;
            const x = 116;
            const bottomAnchor = 906;
            const lineHeight = 89;

            const words = text.split(' ');
            let line = '';
            const lines = [];

            for (let n = 0; n < words.length; n++) {
                let testLine = line + words[n] + ' ';
                let metrics = ctx.measureText(testLine);
                if (metrics.width > maxWidth && n > 0) {
                    lines.push(line.trim());
                    line = words[n] + ' ';
                } else {
                    line = testLine;
                }
            }
            lines.push(line.trim());

            const totalHeight = lines.length * lineHeight;
            let y = bottomAnchor - totalHeight;

            lines.forEach((l, i) => {
                ctx.fillText(l, x, y + (i * lineHeight));
            });
            
            shapeLabel.textContent = `Variant ${activeShapeIndex}`;
        }

        async function waitForFonts() {
            if (document.fonts) {
                await document.fonts.ready;
            }
        }

        // Events
        textInput.oninput = render;
        weightInput.onchange = render;
        shapeToggle.onchange = render;
        frameToggle.onchange = render;
        window.onresize = updateScale;
        
        shuffleShapeBtn.onclick = () => {
            const shapes = ["01", "02", "03"];
            let nextIndex = shapes.indexOf(activeShapeIndex) + 1;
            if (nextIndex >= shapes.length) nextIndex = 0;
            activeShapeIndex = shapes[nextIndex];
            if (!shapeToggle.checked) shapeToggle.checked = true;
            render();
        };

        randomBtn.onclick = () => {
            activeColor = allColors[Math.floor(Math.random() * allColors.length)];
            const shapes = ["01", "02", "03"];
            activeShapeIndex = shapes[Math.floor(Math.random() * shapes.length)];
            updateActiveDot();
            render();
        };

        downloadBtn.onclick = () => {
            const rawText = textInput.value.trim();
            const safeName = rawText
                ? rawText.toLowerCase().replace(/[^a-z0-9\s]/g, '').replace(/\s+/g, '-').replace(/^-+|-+$/g, '')
                : 'solid-studio';
            const link = document.createElement('a');
            link.download = `${safeName}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        };

        // Init
        window.onload = async () => {
            lucide.createIcons();
            initColors();
            await preloadImages();
            await waitForFonts();
            updateScale();
            render();
            setTimeout(updateScale, 100);
        };
    </script>
</body>
</html>