<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SolidStudio">
    <meta name="theme-color" content="#000000">
    <title>Solid Studio Pro</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* iOS System Font Stack */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
            background-color: #000000;
            color: white;
            overflow: hidden;
            position: fixed;
            width: 100vw;
            height: 100dvh;
            -webkit-font-smoothing: antialiased;
        }

        * {
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        input, textarea {
            font-size: 17px !important; /* iOS standard input size to prevent auto-zoom */
            user-select: text;
            -webkit-user-select: text;
        }

        /* Native-feeling button scales */
        button:active {
            transform: scale(0.96);
            opacity: 0.8;
        }

        .canvas-container {
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            transform-origin: center;
            will-change: transform;
            filter: drop-shadow(0 20px 50px rgba(0,0,0,0.5));
        }

        /* iOS Switch Styling */
        .ios-switch {
            width: 51px;
            height: 31px;
            background: #39393d;
            border-radius: 16px;
            position: relative;
            transition: background 0.2s;
            cursor: pointer;
        }
        .ios-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 27px;
            height: 27px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
            transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        input:checked + .ios-switch {
            background: #34c759;
        }
        input:checked + .ios-switch::after {
            transform: translateX(20px);
        }

        /* Native Tab Bar */
        .segmented-control {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 2px;
            display: flex;
        }
        .segment-btn {
            flex: 1;
            padding: 6px 0;
            font-size: 13px;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.2s;
        }
        .segment-btn.active {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        /* Control Sheet Styling */
        #sidebar {
            background: rgba(28, 28, 30, 0.94);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 0.5px solid rgba(255,255,255,0.1);
            padding: 16px max(16px, env(safe-area-inset-right)) max(34px, env(safe-area-inset-bottom)) max(16px, env(safe-area-inset-left));
            border-radius: 24px 24px 0 0;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.4);
        }

        .section-header {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #8e8e93;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .ios-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
        }

        .ios-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 0.5px solid rgba(255,255,255,0.05);
        }
        .ios-row:last-child { border-bottom: none; }

        #exportModal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            z-index: 100;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .weight-btn.active {
            background-color: #007aff !important;
            color: white !important;
        }

        .color-dot-active {
            box-shadow: 0 0 0 2px #007aff, 0 0 0 4px rgba(0,122,255,0.3);
            transform: scale(1.1);
        }

        /* Layout Fixes */
        #layoutContainer {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }

        #viewport {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 1;
        }

        /* Scrollable container for the sheet */
        .controls-scroll {
            overflow-y: auto;
            max-height: 50vh;
            padding-bottom: 20px;
        }

        @media (orientation: landscape) {
            #layoutContainer { flex-direction: row; }
            #sidebar { 
                width: 360px; 
                height: 100%; 
                border-radius: 0; 
                border-top: none; 
                border-left: 0.5px solid rgba(255,255,255,0.1); 
            }
            .controls-scroll { max-height: calc(100vh - 120px); }
        }
    </style>
</head>
<body>
    <!-- Export View (iOS Action Sheet style) -->
    <div id="exportModal">
        <div class="max-w-xs w-full px-6 flex flex-col items-center gap-6">
            <div class="w-full rounded-2xl overflow-hidden shadow-2xl">
                <img id="exportPreview" class="w-full h-auto" alt="Preview">
            </div>
            <p class="text-center text-sm text-zinc-400">Long-press image to save to Photos</p>
            <button id="closeExport" class="w-full bg-white text-black py-4 rounded-2xl font-bold text-lg">Done</button>
        </div>
    </div>

    <div id="layoutContainer">
        <!-- Main Canvas Area -->
        <main id="viewport" class="touch-none">
            <div id="container" class="canvas-container relative">
                <canvas id="mainCanvas" width="1000" height="1000" class="w-full h-full block rounded-lg"></canvas>
            </div>
        </main>

        <!-- iOS Bottom Sheet -->
        <aside id="sidebar">
            <!-- Drag Indicator (Mobile) -->
            <div class="w-10 h-1 bg-white/20 rounded-full mx-auto mb-6 block md:hidden"></div>

            <div class="controls-scroll space-y-6">
                <!-- Text Section -->
                <section>
                    <div class="section-header"><i data-lucide="type" class="w-4 h-4"></i> Typography</div>
                    <div class="ios-card">
                        <textarea id="textInput" class="w-full bg-transparent p-4 text-white focus:outline-none placeholder-zinc-600 font-medium" rows="2" placeholder="Tap to type...">Refined by design.</textarea>
                    </div>
                </section>

                <!-- Weight and Style -->
                <section>
                    <div class="section-header"><i data-lucide="bold" class="w-4 h-4"></i> Appearance</div>
                    <div class="ios-card flex p-1">
                        <button data-weight="400" class="weight-btn flex-1 py-3 rounded-lg text-lg font-[400]">B</button>
                        <button data-weight="500" class="weight-btn flex-1 py-3 rounded-lg text-lg font-[500]">B</button>
                        <button data-weight="700" class="weight-btn flex-1 py-3 rounded-lg text-lg font-[700] active">B</button>
                        <button data-weight="900" class="weight-btn flex-1 py-3 rounded-lg text-lg font-[900]">B</button>
                    </div>
                </section>

                <!-- Color & Tabs -->
                <section>
                    <div class="flex items-center justify-between mb-2">
                        <div class="section-header mb-0"><i data-lucide="palette" class="w-4 h-4"></i> Colors</div>
                        <div class="segmented-control w-32">
                            <button id="tabSolid" class="segment-btn active">Solid</button>
                            <button id="tabGradient" class="segment-btn">Grad</button>
                        </div>
                    </div>
                    
                    <div id="solidControls" class="ios-card p-4 grid grid-cols-6 gap-4"></div>

                    <div id="gradientControls" class="hidden ios-card p-4 space-y-4">
                        <div class="flex justify-between items-center px-2">
                            <button id="slot0" class="grad-slot w-10 h-10 rounded-full border-2 border-white/20"></button>
                            <button id="slot1" class="grad-slot w-10 h-10 rounded-full border-2 border-white/20"></button>
                            <button id="slot2" class="grad-slot w-10 h-10 rounded-full border-2 border-white/20"></button>
                            <button id="slot3" class="grad-slot w-10 h-10 rounded-full border-2 border-white/20"></button>
                            <button id="shuffleGradientColors" class="w-10 h-10 flex items-center justify-center bg-white/10 rounded-full"><i data-lucide="refresh-cw" class="w-4 h-4"></i></button>
                        </div>
                    </div>
                </section>

                <!-- Overlays -->
                <section>
                    <div class="section-header"><i data-lucide="layers" class="w-4 h-4"></i> Overlays</div>
                    <div class="ios-card">
                        <div class="ios-row">
                            <div class="flex flex-col">
                                <span class="text-[15px] font-medium">Shape Overlay</span>
                                <span id="shapeLabel" class="text-[12px] text-zinc-500">Variant 01</span>
                            </div>
                            <div class="flex items-center gap-4">
                                <button id="shuffleShapeBtn" class="text-blue-500 text-sm font-semibold">Next</button>
                                <label class="inline-flex items-center">
                                    <input type="checkbox" id="shapeToggle" class="sr-only">
                                    <div class="ios-switch"></div>
                                </label>
                            </div>
                        </div>
                        <div class="ios-row">
                            <span class="text-[15px] font-medium">Frame Overlay</span>
                            <label class="inline-flex items-center">
                                <input type="checkbox" id="frameToggle" class="sr-only">
                                <div class="ios-switch"></div>
                            </label>
                        </div>
                        <div class="ios-row">
                            <span class="text-[15px] font-medium">Blend Layers</span>
                            <button id="blendModeToggle" class="text-blue-500 text-sm font-semibold">Overlay</button>
                        </div>
                    </div>
                </section>

                <!-- Image Upload -->
                <section>
                    <div class="section-header"><i data-lucide="image" class="w-4 h-4"></i> Background</div>
                    <div class="flex gap-2">
                        <label class="flex-grow ios-card p-4 flex items-center justify-center gap-2 cursor-pointer active:bg-white/10 transition-colors">
                            <input type="file" id="imageUpload" class="hidden" accept="image/*">
                            <i data-lucide="upload" class="w-4 h-4 text-blue-500"></i>
                            <span class="text-sm font-medium text-blue-500" id="uploadLabel">Add Photo</span>
                        </label>
                        <button id="clearImage" class="hidden w-14 ios-card items-center justify-center text-red-500">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                </section>
            </div>

            <!-- Global Actions -->
            <div class="mt-6 flex gap-3">
                <button id="randomBtn" class="flex-1 ios-card py-4 font-semibold text-white">Randomize</button>
                <button id="exportBtn" class="flex-[2] bg-blue-600 rounded-xl py-4 font-bold text-lg shadow-lg">Save Image</button>
            </div>
        </aside>
    </div>

    <!-- Hidden Popover for Color Picking (kept logic) -->
    <div id="colorPopover" class="hidden fixed z-[200] bg-[#2c2c2e] p-4 rounded-2xl shadow-2xl border border-white/10 grid grid-cols-5 gap-3 max-w-[260px]"></div>

    <script>
        const CANVAS_SIZE = 1000;
        const BASE_PALETTE = [[100, 116, 139], [239, 68, 68], [249, 115, 22], [245, 158, 11], [234, 179, 8], [34, 197, 94], [16, 185, 129], [20, 184, 166], [6, 182, 212], [14, 165, 233], [59, 130, 246], [99, 102, 241]];
        const NEW_HEX_COLORS = ["#355B58", "#524A41", "#535647", "#5E3D5E", "#50525A", "#6A5645", "#6A6248", "#4B5D45", "#365567", "#53e14c", "#FA4E63", "#17A8FF", "#F5C81E", "#C24C2D", "#3B356A", "#6C2D55", "#9B4658", "#133F35"];

        let activeColor = [59, 130, 246];
        let gradColors = ["#1c1c1e", "#007aff", "#1c1c1e", "#5856d6"];
        let activeShapeIndex = "01";
        let activeWeight = 700;
        let bgImage = null;
        let blendMode = 'overlay'; 
        let backgroundMode = 'solid';
        let currentSlotIndex = 0;
        const allColors = [];
        const images = {};

        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('container');
        const viewport = document.getElementById('viewport');
        const textInput = document.getElementById('textInput');
        const solidControls = document.getElementById('solidControls');
        const gradientControls = document.getElementById('gradientControls');
        const tabSolid = document.getElementById('tabSolid');
        const tabGradient = document.getElementById('tabGradient');
        const exportBtn = document.getElementById('exportBtn');
        const randomBtn = document.getElementById('randomBtn');
        const shuffleShapeBtn = document.getElementById('shuffleShapeBtn');
        const shapeToggle = document.getElementById('shapeToggle');
        const frameToggle = document.getElementById('frameToggle');
        const blendModeToggle = document.getElementById('blendModeToggle');
        const colorPopover = document.getElementById('colorPopover');
        const exportModal = document.getElementById('exportModal');
        const exportPreview = document.getElementById('exportPreview');
        const closeExport = document.getElementById('closeExport');

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? [parseInt(result[1], 16), parseInt(result[2], 16), parseInt(result[3], 16)] : null;
        }

        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        function initColors() {
            BASE_PALETTE.forEach(c => allColors.push(c));
            NEW_HEX_COLORS.forEach(h => { const rgb = hexToRgb(h); if (rgb) allColors.push(rgb); });
            
            allColors.forEach(rgb => {
                const btn = document.createElement('button');
                btn.className = 'aspect-square rounded-full transition-transform active:scale-90';
                btn.style.backgroundColor = `rgb(${rgb.join(',')})`;
                btn.onclick = () => { activeColor = rgb; updateActiveUI(); render(); };
                solidControls.appendChild(btn);
            });

            allColors.forEach(rgb => {
                const hex = rgbToHex(rgb[0], rgb[1], rgb[2]);
                const btn = document.createElement('button');
                btn.className = 'w-8 h-8 rounded-full border border-white/10 active:scale-90';
                btn.style.backgroundColor = hex;
                btn.onclick = (e) => {
                    e.stopPropagation();
                    gradColors[currentSlotIndex] = hex;
                    document.getElementById(`slot${currentSlotIndex}`).style.backgroundColor = hex;
                    colorPopover.classList.add('hidden');
                    render();
                };
                colorPopover.appendChild(btn);
            });

            updateActiveUI();
        }

        async function preloadImages() {
            const paths = {
                'shape_01': 'https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/shapes.svg', // Placeholder SVGs since local assets aren't guaranteed
                'shape_02': 'overlay/shape_02.png', 
                'shape_03': 'overlay/shape_03.png', 
                'frame': 'overlay/frame.png'
            };
            const load = (k, s) => new Promise(resolve => {
                const i = new Image();
                i.crossOrigin = "anonymous";
                i.onload = () => { images[k] = i; resolve(); };
                i.onerror = () => resolve();
                i.src = s;
            });
            await Promise.all(Object.entries(paths).map(([k, v]) => load(k, v)));
        }

        function updateActiveUI() {
            solidControls.querySelectorAll('button').forEach((b, i) => {
                if (JSON.stringify(allColors[i]) === JSON.stringify(activeColor)) b.classList.add('color-dot-active');
                else b.classList.remove('color-dot-active');
            });
            
            gradColors.forEach((hex, i) => {
                document.getElementById(`slot${i}`).style.backgroundColor = hex;
            });
        }

        function render() {
            const text = textInput.value;
            ctx.globalCompositeOperation = 'source-over';
            
            if (backgroundMode === 'solid') {
                ctx.fillStyle = `rgb(${activeColor.join(',')})`;
                ctx.fillRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);
            } else {
                ctx.fillStyle = gradColors[0];
                ctx.fillRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);

                let grad1 = ctx.createRadialGradient(CANVAS_SIZE * 0.9, CANVAS_SIZE * 0.9, 0, CANVAS_SIZE * 0.8, CANVAS_SIZE * 0.8, CANVAS_SIZE * 0.9);
                grad1.addColorStop(0, gradColors[1]);
                grad1.addColorStop(1, 'transparent');
                ctx.fillStyle = grad1;
                ctx.fillRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);

                let grad2 = ctx.createRadialGradient(CANVAS_SIZE * 0.45, CANVAS_SIZE * 0.05, 0, CANVAS_SIZE * 0.5, CANVAS_SIZE * 0.1, CANVAS_SIZE * 0.7);
                grad2.addColorStop(0, gradColors[2]);
                grad2.addColorStop(1, 'transparent');
                ctx.fillStyle = grad2;
                ctx.fillRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);

                let grad3 = ctx.createRadialGradient(CANVAS_SIZE * 0.05, CANVAS_SIZE * 0.5, 0, CANVAS_SIZE * 0.1, CANVAS_SIZE * 0.5, CANVAS_SIZE * 0.8);
                grad3.addColorStop(0, gradColors[3]);
                grad3.addColorStop(1, 'transparent');
                ctx.fillStyle = grad3;
                ctx.fillRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);
            }

            if (bgImage) {
                const scale = Math.max(CANVAS_SIZE / bgImage.width, CANVAS_SIZE / bgImage.height);
                const x = (CANVAS_SIZE / 2) - (bgImage.width / 2) * scale;
                const y = (CANVAS_SIZE / 2) - (bgImage.height / 2) * scale;
                ctx.drawImage(bgImage, x, y, bgImage.width * scale, bgImage.height * scale);
            }

            const currentBlendMode = blendMode === 'overlay' ? 'overlay' : 'source-over';
            
            if (shapeToggle.checked && images[`shape_${activeShapeIndex}`]) {
                ctx.globalCompositeOperation = currentBlendMode; 
                ctx.drawImage(images[`shape_${activeShapeIndex}`], 0, 0, CANVAS_SIZE, CANVAS_SIZE);
            }

            if (frameToggle.checked && images['frame']) {
                ctx.globalCompositeOperation = currentBlendMode;
                ctx.drawImage(images['frame'], 0, 0, CANVAS_SIZE, CANVAS_SIZE);
            }

            ctx.globalCompositeOperation = 'source-over';
            let brightness;
            if (backgroundMode === 'solid') {
                brightness = (activeColor[0] * 299 + activeColor[1] * 587 + activeColor[2] * 114) / 1000;
            } else {
                const rgbBase = hexToRgb(gradColors[0]) || [0,0,0];
                brightness = (rgbBase[0] * 299 + rgbBase[1] * 587 + rgbBase[2] * 114) / 1000;
            }
            
            ctx.fillStyle = (bgImage || brightness < 160) ? '#ffffff' : '#000000';
            ctx.font = `${activeWeight} 90px -apple-system, sans-serif`;
            ctx.textAlign = 'left';
            ctx.textBaseline = 'alphabetic';

            const maxWidth = 760;
            const x = 116; 
            const bottomAnchor = 889; 
            const lineHeight = 100;

            const words = text.split(' ');
            let line = '';
            const lines = [];

            for (let n = 0; n < words.length; n++) {
                let testLine = line + words[n] + ' ';
                if (ctx.measureText(testLine).width > maxWidth && n > 0) {
                    lines.push(line.trim());
                    line = words[n] + ' ';
                } else {
                    line = testLine;
                }
            }
            lines.push(line.trim());

            for (let i = 0; i < lines.length; i++) {
                const yPos = bottomAnchor - (i * lineHeight);
                ctx.fillText(lines[lines.length - 1 - i], x, yPos);
            }
            
            document.getElementById('shapeLabel').textContent = `Variant ${activeShapeIndex}`;
            blendModeToggle.textContent = blendMode === 'overlay' ? 'Overlay' : 'Normal';
        }

        // Logic for slot clicking & positioning popover
        document.querySelectorAll('.grad-slot').forEach((btn, idx) => {
            btn.onclick = (e) => {
                e.stopPropagation();
                currentSlotIndex = idx;
                const rect = btn.getBoundingClientRect();
                colorPopover.style.left = `${rect.left}px`;
                colorPopover.style.top = `${rect.top - 180}px`;
                colorPopover.classList.toggle('hidden');
            };
        });

        document.addEventListener('click', () => {
            colorPopover.classList.add('hidden');
        });

        tabSolid.onclick = () => {
            backgroundMode = 'solid';
            tabSolid.classList.add('active');
            tabGradient.classList.remove('active');
            solidControls.classList.remove('hidden');
            gradientControls.classList.add('hidden');
            render();
        };

        tabGradient.onclick = () => {
            backgroundMode = 'gradient';
            tabGradient.classList.add('active');
            tabSolid.classList.remove('active');
            gradientControls.classList.remove('hidden');
            solidControls.classList.add('hidden');
            render();
        };

        document.getElementById('shuffleGradientColors').onclick = () => {
            const pick = () => {
                const rgb = allColors[Math.floor(Math.random() * allColors.length)];
                return rgbToHex(rgb[0], rgb[1], rgb[2]);
            };
            gradColors = gradColors.map(() => pick());
            updateActiveUI();
            render();
        };

        document.getElementById('imageUpload').onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (f) => {
                const img = new Image();
                img.onload = () => {
                    bgImage = img;
                    document.getElementById('uploadLabel').textContent = file.name;
                    document.getElementById('clearImage').classList.remove('hidden');
                    document.getElementById('clearImage').classList.add('flex');
                    render();
                };
                img.src = f.target.result;
            };
            reader.readAsDataURL(file);
        };

        document.getElementById('clearImage').onclick = () => {
            bgImage = null;
            document.getElementById('imageUpload').value = '';
            document.getElementById('uploadLabel').textContent = 'Add Photo';
            document.getElementById('clearImage').classList.add('hidden');
            render();
        };

        document.querySelectorAll('.weight-btn').forEach(btn => {
            btn.onclick = () => {
                activeWeight = parseInt(btn.dataset.weight);
                document.querySelectorAll('.weight-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                render();
            };
        });

        blendModeToggle.onclick = () => {
            blendMode = blendMode === 'overlay' ? 'source-over' : 'overlay';
            render();
        };

        exportBtn.onclick = () => {
            const dataUrl = canvas.toDataURL('image/png', 1.0);
            exportPreview.src = dataUrl;
            exportModal.style.display = 'flex';
        };

        closeExport.onclick = () => {
            exportModal.style.display = 'none';
        };

        function updateScale() {
            const padding = 24;
            const maxScale = Math.min(
                (viewport.clientWidth - padding * 2) / CANVAS_SIZE,
                (viewport.clientHeight - padding * 2) / CANVAS_SIZE
            );
            container.style.transform = `scale(${Math.max(maxScale, 0.2)})`;
        }

        window.addEventListener('resize', updateScale);
        window.addEventListener('orientationchange', () => setTimeout(updateScale, 150));

        textInput.addEventListener('input', render);
        shapeToggle.addEventListener('change', render);
        frameToggle.addEventListener('change', render);
        
        shuffleShapeBtn.onclick = () => {
            activeShapeIndex = ["01", "02", "03"][(["01", "02", "03"].indexOf(activeShapeIndex) + 1) % 3];
            shapeToggle.checked = true;
            render();
        };

        randomBtn.onclick = () => {
            if (backgroundMode === 'solid') {
                activeColor = allColors[Math.floor(Math.random() * allColors.length)];
                updateActiveUI();
            } else {
                document.getElementById('shuffleGradientColors').click();
            }
            render();
        };

        window.onload = async () => {
            lucide.createIcons();
            initColors();
            await preloadImages();
            updateScale();
            render();
        };
    </script>
</body>
</html>