<!DOCTYPE html>
<html>
<head>
  <title>News Alligator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <style>
    /* Material Design Dark Mode styling */
    body {
      font-family: "Roboto", sans-serif;
      background-color: #121212;
      color: #FFFFFF;
      margin: 0;
      padding: 0;
    }

    h1 {
      text-align: left;
      padding-top: 20px;
      padding-left: 20px;
      color: #FFFFFF;
      margin: 0;
      -webkit-app-region: drag;
    }

    #news-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      padding: 20px;
    }

    .article-card {
      background-color: #212121;
      border-radius: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin: 10px;
      width: 400px;
      overflow: hidden;
      position: relative;
    }

    .article-image {
      width: 100%;
      height: 250px;
      object-fit: cover;
      border-top-left-radius: 4px;
      border-top-right-radius: 4px;
      cursor: pointer;
    }

    .article-image img {
      width: 100%;
      height: auto;
    }

    .article-content {
      padding: 16px;
    }

    .article-date-source {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: #9E9E9E;
      margin-bottom: 8px;
      vertical-align: middle;
    }

    .article-date-source .material-icons {
      font-size: 15px;
      margin-right: 4px;
      vertical-align: middle;
    }

    .article-date {
      margin-bottom: 4px;
    }

    .article-days-ago {
      margin-top: 0;
      margin-left: 19px;
    }

    .article-title {
      font-size: 20px;
      font-weight: bold;
      margin: 10px 0;
      color: #FFFFFF;
    }

    .article-description {
      margin-bottom: 16px;
      color: #FFFFFF;
    }

    .article-link {
      text-decoration: none;
      color: #1E88E5;
      display: inline-block;
    }

    .current-date {
      color: #9E9E9E;
      font-size: 14px;
      margin-bottom: 0;
      margin-top: 0px;
      margin-left: 20px;
    }

  </style>

  <!-- Apple WebKit support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <!-- App Icon -->
  <link rel="apple-touch-icon" sizes="180x180" href="https://res.cloudinary.com/di8j84ent/image/upload/v1689564176/apple-touch-icon_jq66yl.png">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="https://res.cloudinary.com/di8j84ent/image/upload/v1689564176/favicon_hwojbp.ico">

</head>
<body>
  <h1>News Alligator</h1>
  <p id="current-date" class="current-date"></p>
  <div id="news-container"></div>

  <script>
    const rssFeedUrl = 'https://rss.app/feeds/_wzychKsCWii9zoSJ.xml';

    const fetchRSSData = async () => {
      try {
        const response = await fetch(rssFeedUrl);
        const data = await response.text();
        return data;
      } catch (error) {
        console.error('Error fetching RSS data:', error);
        return '';
      }
    };

    const parseRSSData = (rssData) => {
      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(rssData, 'text/xml');
      const items = xmlDoc.getElementsByTagName('item');

      const feedItems = [];
      for (let i = 0; i < items.length; i++) {
        const title = items[i].getElementsByTagName('title')[0].textContent;
        const descriptionNode = items[i].getElementsByTagName('description')[0];
        const description = getDescriptionText(descriptionNode);
        const link = items[i].getElementsByTagName('link')[0].textContent;
        const pubDate = items[i].getElementsByTagName('pubDate')[0].textContent;
        const source = getSource(items[i]) || '';

        const articleCard = document.createElement('div');
        articleCard.classList.add('article-card');

        const articleImage = document.createElement('a');
        articleImage.classList.add('article-image');
        articleImage.href = link || '';
        articleImage.target = '_blank';

        const image = document.createElement('img');
        image.src = getImageURL(items[i]) || 'placeholder.jpg';
        articleImage.appendChild(image);

        articleCard.appendChild(articleImage);

        const articleContent = document.createElement('div');
        articleContent.classList.add('article-content');

        const dateSourceElement = document.createElement('div');
        dateSourceElement.classList.add('article-date-source');

        const dateElement = document.createElement('p');
        const formattedDate = formatDate(pubDate);
        dateElement.classList.add('article-date');
        dateElement.innerHTML = `<span class="material-icons">event</span>${formattedDate}`;
        dateSourceElement.appendChild(dateElement);

        const sourceElement = document.createElement('p');
        sourceElement.innerHTML = `<span class="material-icons">source</span>${source}`;
        dateSourceElement.appendChild(sourceElement);

        articleContent.appendChild(dateSourceElement);

        const titleElement = document.createElement('h2');
        titleElement.classList.add('article-title');
        titleElement.textContent = title || '';
        articleContent.appendChild(titleElement);

        const descriptionElement = document.createElement('p');
        descriptionElement.classList.add('article-description');
        descriptionElement.textContent = description || '';
        articleContent.appendChild(descriptionElement);

        const linkElement = document.createElement('a');
        linkElement.classList.add('article-link');
        linkElement.textContent = 'Read More';
        linkElement.href = link || '';
        linkElement.target = '_blank';
        articleContent.appendChild(linkElement);

        articleCard.appendChild(articleContent);
        feedItems.push(articleCard);
      }

      return feedItems;
    };

    const getDescriptionText = (descriptionNode) => {
      let descriptionText = '';
      const childNodes = descriptionNode.childNodes;

      for (let i = 0; i < childNodes.length; i++) {
        const node = childNodes[i];
        if (node.nodeType === Node.TEXT_NODE) {
          descriptionText += node.textContent.trim();
        }
      }

      return descriptionText;
    };

    const getImageURL = (item) => {
      const description = item.getElementsByTagName('description')[0]?.textContent || '';
      const match = description.match(/<img\s+.*?src\s*=\s*['"]([^'"]+)['"].*?>/i);
      return match ? match[1] : '';
    };

    const getSource = (item) => {
      const creator = item.getElementsByTagName('dc:creator')[0]?.textContent || '';
      return creator.trim();
    };

    const displayNewsArticles = async () => {
      try {
        const rssData = await fetchRSSData();
        const feedItems = parseRSSData(rssData);

        const newsContainer = document.getElementById('news-container');
        newsContainer.innerHTML = '';

        for (const item of feedItems) {
          newsContainer.appendChild(item);
        }
      } catch (error) {
        console.error('Error displaying news articles:', error);
      }
    };

    const formatDate = (dateString) => {
      const options = { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' };
      const date = new Date(dateString);
      return date.toLocaleDateString(undefined, options);
    };

    const getDaysAgo = (dateString) => {
      const today = new Date();
      const date = new Date(dateString);
      const diffInTime = today.getTime() - date.getTime();
      const diffInDays = Math.floor(diffInTime / (1000 * 3600 * 24));
      return diffInDays > 0 && diffInDays <= 7 ? `${diffInDays} ${diffInDays === 1 ? 'day' : 'days'} ago` : '';
    };

    const displayCurrentDate = () => {
      const currentDateElement = document.getElementById('current-date');
      const currentDate = formatDate(new Date().toISOString());
      currentDateElement.textContent = currentDate;
    };

    displayCurrentDate();
    displayNewsArticles();

    // Refresh the content every 5 minutes
    setInterval(() => {
      displayNewsArticles();
    }, 5 * 60 * 1000);
  </script>
</body>
</html>
