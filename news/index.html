<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">
<title>London News</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
<link rel="icon" href="favicon.ico">
<link rel="manifest" href="manifest.json">


<style>
:root{
  --blur-amount: 10px;
  --transition-speed: 0.25s;
  --overlay-color: rgba(0,0,0,0.25);
  --font: 'Nunito', sans-serif;
}

/* Page */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:var(--font);
  background:#292a2d;
  color:#fff;
  display:flex;
  flex-direction:column;
  min-height:100vh;
  padding: calc(16px + env(safe-area-inset-top)) 16px calc(116px + env(safe-area-inset-bottom));
}

/* ==============================
   FROSTED TOP BAR
============================== */

.topbar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  display: flex;
  align-items: center; /* use center instead of flex-end */
  justify-content: space-between;
  padding: calc(env(safe-area-inset-top, 0px) + 0.75rem) 1.5rem 0.75rem;
  background: rgba(24, 21, 38, 0.6);
  backdrop-filter: blur(14px);
  border-bottom: 1px solid rgba(255,255,255,0.08);
  z-index: 1000;
  transition: transform 0.45s ease, opacity 0.35s ease;
  box-sizing: border-box;
}



.topbar.hidden {
  transform: translateY(-100%);
  opacity: 0;
}

/* Logo group */
.logo {
  display: flex;
  align-items: center;
  gap: 0.65rem;
  position: relative;
  top: 0px; /* nudges group down slightly */
}

.logo-icon {
  width: 45px;
  object-fit: contain;
  position: relative;
  top: -4px; /* visually centers icon with text baseline */
}

.logo-text {
  font-size: 1.15rem;
  font-weight: 800;
  line-height: 1;
  letter-spacing: 0.25px;
  color: #fff;
  opacity: 0.95;
  display: flex;
  align-items: center;
  height: 28px;
}

/* Date text */
.topbar .date {
  font-size: 1.15rem;
  font-weight: 800;
  line-height: 1;
  letter-spacing: 0.25px;
  color: #fff;
  opacity: 0.95;
  display: flex;
  align-items: center;
  height: 28px;
}

.topbar.hidden {
  transform: translateY(-100%);
  opacity: 0;
}

.controls{
  display:flex;
  gap:0.6rem;
}
.btn{
  background:transparent;
  border:1px solid rgba(255,255,255,0.15);
  color:#fff;
  border-radius:999px;
  padding:0.5rem 0.9rem;
  cursor:pointer;
  font-weight:800;
  font-size: 1rem;
  transition:transform .2s, background .25s, border-color .25s;
}
.btn:hover{ transform:translateY(-1px); background:rgba(255,255,255,0.06); border-color:rgba(255,255,255,0.25); }
.btn i{ font-style:normal; }

/* Toast */
.toast{
  position:fixed;
  bottom:110px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.2);
  color:#fff;
  padding:0.6rem 1.2rem;
  border-radius:20px;
  font-weight:800;
  opacity:0;
  transition:opacity .35s ease;
  z-index:9999;
  backdrop-filter: blur(10px);
}

/* Floating Buttons */
.floating-controls {
  position: fixed;
  bottom: 1.5rem;
  right: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
  z-index: 9999;
}

.float-btn {
  width: 62px;
  height: 62px;
  border-radius: 50%;
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.2);
  color: #fff;
  font-size: 1.9rem;
  cursor: pointer;
  backdrop-filter: blur(10px);
  transition: background 0.25s, transform 0.25s, opacity 0.25s;
  padding-top: 4px;
}

.float-btn:hover {
  background: rgba(255,255,255,0.15);
  transform: scale(1.08);
}

#backToTopBtn {
  opacity: 0;
  pointer-events: none;
}

#backToTopBtn.visible {
  opacity: 1;
  pointer-events: auto;
}


/* Grid */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
  gap:1.5rem;
  width:100%;
  max-width:1200px;
  margin:0 auto;
  margin-top: 72px;
}

/* Card base */
.card{
  position:relative;
  height:320px;
  border-radius:16px;
  overflow:hidden;
  cursor:pointer;
  background-size:cover;
  background-position:center;
  background-blend-mode: soft-light;
  filter:saturate(0.9) contrast(0.95);
  transition:filter var(--transition-speed) ease, transform .25s ease;
}
.card:hover,
.card.active{ filter:saturate(1) contrast(1.05); }

/* overlay */
.card::before{
  content:"";
  position:absolute;
  inset:0;
  background:var(--overlay-color);
  transition:backdrop-filter var(--transition-speed) ease, background var(--transition-speed) ease;
  z-index:1;
}

.source-header {
  position: absolute;
  top: 0.8rem;
  left: 1.2rem;
  z-index: 3;
  display: flex;
  align-items: center;
  gap: 0.4rem;
  text-shadow:
  0 0 5px rgba(0,0,0,0.55),
  0 0 10px rgba(0,0,0,0.35);

}

.source-logo {
  width: 40px;
  object-fit: contain;
  border-radius: 3px;
}

.source-name {
  font-weight: 800;
  font-size: 0.8rem;
  letter-spacing: 0.2px;
  opacity: 0.95;
}


/* Info (title/meta) */
.info{
  position:absolute;
  bottom:0; left:0; right:0;
  padding:1.2rem;
  z-index:2;
  transition:opacity var(--transition-speed) ease;
  
}
.info h2{
  margin:0;
  font-size:1.75rem;
  line-height:1;
  font-weight:900;
  text-shadow:
  0 0 5px rgba(0,0,0,0.55),
  0 0 10px rgba(0,0,0,0.35);

}
.info .meta{
  font-size:0.9rem;
  opacity:0.85;
  margin-top:0.4rem;
  font-weight:700;
  text-shadow:
  0 0 5px rgba(0,0,0,0.55),
  0 0 10px rgba(0,0,0,0.35);
}

/* Content (expanded) */
.content{
  position:absolute;
  inset:0;
  padding:1.5rem;
  display:flex;
  flex-direction:column;
  justify-content:flex-end;
  opacity:0;
  transform:scale(0.98);
  z-index:3;
  pointer-events:none;
  transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease;
}
.content p{
  font-size:1.3rem;
  line-height:1.5;
  margin-bottom:1rem;
  color:#e8eeff;
}
.content a{
  text-decoration:none;
  align-self:flex-start;
  background:#fff;
  color:#000;
  border-radius:24px;
  padding:0.6rem 1.2rem;
  font-weight:800;
  transition:background .25s, transform .25s;
}
.content a:hover{ background:#ddd; transform:scale(1.05); }

/* Active state */
.card.active::before{
  /* Use the per-card dark color if present; fallback to darker black */
  backdrop-filter: blur(var(--blur-amount));
  background: color-mix(in oklab, var(--dark-source-color, rgba(0,0,0,0.8)) 55%, transparent);
}
.card.active .info{ opacity:0; }
.card.active .content{
  opacity:1; transform:scale(1); pointer-events:auto;
}

/* Empty state */
.empty{
  grid-column:1/-1;
  background:rgba(255,255,255,0.04);
  border:1px dashed rgba(255,255,255,0.15);
  padding:2rem;
  border-radius:16px;
  text-align:center;
  color:#e8eeff;
  font-weight:800;
}

/* Counter-clockwise spin for refresh icon */
.bx-spin {
  animation: bx-reverse-spin 2s linear infinite !important;
}

@keyframes bx-reverse-spin {
  0%   { transform: rotate(0deg); }
  100% { transform: rotate(-360deg); }
}


</style>
</head>
<body>

<div class="topbar" id="topbar">
  <div class="logo">
    <img src="images/LN-logo-svg.svg" alt="London News Logo" class="logo-icon">
    <span class="logo-text">London News</span>
  </div>
  <div class="date" id="currentDate"></div>
</div>


<div class="grid" id="grid"></div>

<div class="toast" id="toast">Updated just now</div>

<div class="floating-controls">
  <button id="backToTopBtn" class="float-btn">
    <i class='bx bx-up-arrow-alt'></i>
  </button>
  <button id="refreshBtn" class="float-btn">
    <i class='bx bx-refresh'></i>
  </button>
</div>

<script>
/* ---------- Config ---------- */
const PEXELS_API_KEY = 'fB6vzEHx5CsDIVByIpuDfQ2QoliM9TYWyBqmkzPgj6nPeEuWdBvbtJIx';
const gridEl = document.getElementById('grid');
const toastEl = document.getElementById('toast');

/* ---------- State ---------- */
const state = {
  articles: [],
  allSources: [],
  openCard: null
};


/* ---------- Toast ---------- */
function showToast(msg="Updated just now"){
  toastEl.textContent = msg;
  toastEl.style.opacity = '1';
  setTimeout(()=> toastEl.style.opacity = '0', 2200);
}

/* ---------- Helpers ---------- */
function stripHtmlTags(html) {
  if (!html) return '';
  const txt = document.createElement('textarea');
  txt.innerHTML = html;
  let decoded = txt.value;

  // Decode any double-encoded entities (e.g., &#039; inside RSS)
  const temp = document.createElement('textarea');
  temp.innerHTML = decoded;
  decoded = temp.value;

  // Remove HTML tags and collapse whitespace
  decoded = decoded.replace(/<\/?[^>]+(>|$)/g, '');
  decoded = decoded.replace(/\s+/g, ' ').trim();

  // Replace leftover entities that browsers don’t decode automatically
  decoded = decoded
    .replace(/&nbsp;/gi, ' ')
    .replace(/&amp;/gi, '&')
    .replace(/&quot;/gi, '"')
    .replace(/&#039;/gi, "'")
    .replace(/&rsquo;/gi, "'")
    .replace(/&lsquo;/gi, "'")
    .replace(/&ldquo;/gi, '"')
    .replace(/&rdquo;/gi, '"')
    .replace(/&hellip;/gi, '…')
    .replace(/&mdash;/gi, '-')
    .replace(/&ndash;/gi, '-');

  return decoded.trim();
}

function truncateWords(text, n){
  const words = (text||'').trim().split(/\s+/);
  return words.length>n ? words.slice(0,n).join(' ') + '…' : text;
}
function decodeEntities(text) {
  if (!text) return '';
  const txt = document.createElement('textarea');
  txt.innerHTML = text;
  return txt.value;
}

function cleanTitle(title, sourceName) {
  if (!title) return "";
  title = decodeEntities(title);
  return title.replace(new RegExp(`[-|–|:|•]?\\s*${sourceName}\\s*$`, "i"), "").trim();
}

function normalizeHeadline(text) {
  if (!text) return "";
  text = decodeEntities(text); // decode again here just in case
  const letters = text.replace(/[^a-zA-Z]/g, "");
  const upperRatio = letters.replace(/[a-z]/g, "").length / (letters.length || 1);
  if (upperRatio > 0.8) {
    text = text.toLowerCase();
    text = text.replace(/^([“"‘'(\[]*)([a-z])/, (_, p, f) => p + f.toUpperCase());
    text = text.replace(/([.!?]\s+)([a-z])/g, (_, s, c) => s + c.toUpperCase());
  }
  return text
    .replace(/&nbsp;/gi, ' ')
    .replace(/&#039;/gi, "'")
    .replace(/&quot;/gi, '"')
    .replace(/&amp;/gi, '&')
    .replace(/&rsquo;/gi, "'")
    .replace(/&lsquo;/gi, "'")
    .replace(/&ldquo;/gi, '"')
    .replace(/&rdquo;/gi, '"')
    .replace(/&hellip;/gi, '…')
    .replace(/&mdash;/gi, '-')
    .replace(/&ndash;/gi, '-')
    .trim();
}

function formatArticleDate(pubDate){
  const date = new Date(pubDate);
  const time = date.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit', hour12: true });
  const today = new Date();
  const articleDay = new Date(date.getFullYear(), date.getMonth(), date.getDate());
  const todayDay = new Date(today.getMonth(), today.getDate());
  const diff = todayDay - articleDay;
  const oneDay = 86400000;
  if (diff === 0) return time;
  if (diff === oneDay) return `Yesterday • ${time}`;
  return date.toLocaleDateString('en-CA', { month: 'short', day: 'numeric' });
}

/* Color utilities for faithful-but-pretty colours */
function beautifyColor(r,g,b){
  r/=255; g/=255; b/=255;
  const max=Math.max(r,g,b), min=Math.min(r,g,b);
  let h,s,l=(max+min)/2;
  if(max===min){ h=s=0; }
  else{
    const d=max-min;
    s = l>0.5 ? d/(2-max-min) : d/(max+min);
    switch(max){
      case r: h=(g-b)/d + (g<b?6:0); break;
      case g: h=(b-r)/d + 2; break;
      case b: h=(r-g)/d + 4; break;
    }
    h/=6;
  }
  s = Math.min(0.7, s*1.2);
  l = Math.min(0.6, l*1.3);
  const hue2rgb=(p,q,t)=>{
    if(t<0) t+=1; if(t>1) t-=1;
    if(t<1/6) return p+(q-p)*6*t;
    if(t<1/2) return q;
    if(t<2/3) return p+(q-p)*(2/3 - t)*6;
    return p;
  };
  let r2,g2,b2;
  if(s===0){ r2=g2=b2=l; }
  else{
    const q=l<0.5 ? l*(1+s) : l + s - l*s;
    const p=2*l-q;
    r2=hue2rgb(p,q,h+1/3);
    g2=hue2rgb(p,q,h);
    b2=hue2rgb(p,q,h-1/3);
  }
  return [Math.round(r2*255),Math.round(g2*255),Math.round(b2*255)];
}
function rgbToHsl(r,g,b){
  r/=255; g/=255; b/=255;
  const max=Math.max(r,g,b), min=Math.min(r,g,b);
  let h,s,l=(max+min)/2;
  if(max===min){ h=s=0; }
  else{
    const d=max-min;
    s = l>0.5 ? d/(2-max-min) : d/(max+min);
    switch(max){
      case r: h=(g-b)/d + (g<b?6:0); break;
      case g: h=(b-r)/d + 2; break;
      case b: h=(r-g)/d + 4; break;
    }
    h/=6;
  }
  return [h,s,l];
}
function hslToRgb(h,s,l){
  const hue2rgb=(p,q,t)=>{
    if(t<0) t+=1; if(t>1) t-=1;
    if(t<1/6) return p+(q-p)*6*t;
    if(t<1/2) return q;
    if(t<2/3) return p+(q-p)*(2/3 - t)*6;
    return p;
  };
  let r,g,b;
  if(s===0){ r=g=b=l; }
  else{
    const q=l<0.5 ? l*(1+s) : l + s - l*s;
    const p=2*l-q;
    r=hue2rgb(p,q,h+1/3);
    g=hue2rgb(p,q,h);
    b=hue2rgb(p,q,h-1/3);
  }
  return [Math.round(r*255),Math.round(g*255),Math.round(b*255)];
}

/* Extract brand-ish colours from the source logo (with fallbacks) */
async function getGradientFromLogo(logoUrl) {
  return new Promise(resolve => {
    const img = new Image();
    img.crossOrigin = 'Anonymous';
    img.src = logoUrl;
    img.onload = () => {
      try {
        const thief = new ColorThief();
        const [r, g, b] = thief.getColor(img); // main hue only

        // --- generate 3 tones ---
        const [h, s, l] = rgbToHsl(r, g, b);
        const base = hslToRgb(h, s, l);
        const light = hslToRgb(h, s * 0.8, Math.min(1, l * 1.4));
        const dark = hslToRgb(h, s, Math.max(0, l * 0.45));

        const rgb = (arr) => `rgb(${arr[0]}, ${arr[1]}, ${arr[2]})`;
        const sourceColor = rgb(base);
        const lightSourceColor = rgb(light);
        const darkSourceColor = rgb(dark);

        // --- mesh-like composite gradient ---
        const gradient = `
          radial-gradient(at 20% 30%, ${lightSourceColor}, transparent 60%),
          radial-gradient(at 80% 70%, ${sourceColor}, ${darkSourceColor} 80%)
        `;

        resolve({ gradient, sourceColor, darkSourceColor, lightSourceColor });
      } catch (err) {
        resolve({
          gradient: 'radial-gradient(circle, #444, #222)',
          sourceColor: 'rgb(68,68,68)',
          darkSourceColor: 'rgb(34,34,34)',
          lightSourceColor: 'rgb(90,90,90)'
        });
      }
    };
    img.onerror = () => resolve({
      gradient: 'radial-gradient(circle, #444, #222)',
      sourceColor: 'rgb(68,68,68)',
      darkSourceColor: 'rgb(34,34,34)',
      lightSourceColor: 'rgb(90,90,90)'
    });
  });
}



/* Optional Pexels fallback (kept from your previous build) */
async function getPexelsImage(query){
  try{
    const res = await fetch(`https://api.pexels.com/v1/search?query=${encodeURIComponent(query)}&per_page=1`, {
      headers: { Authorization: PEXELS_API_KEY }
    });
    const data = await res.json();
    return data.photos?.[0]?.src?.landscape || null;
  }catch{
    return null;
  }
}

/* ---------- Rendering ---------- */
function makeCardDOM(item, source) {
  const card = document.createElement('div');
  card.className = 'card';
  card.dataset.source = source.name;

  const hasImage = !!(item.thumbnail && !item.thumbnail.includes('placehold.co'));

  // --- Background ---
  if (hasImage) {
    card.style.backgroundImage = `url('${item.thumbnail}')`;
  } else {
    if (source._colors?.gradient) {
      card.style.background = source._colors.gradient;
    } else if (item.sourceColor) {
      card.style.backgroundColor = item.sourceColor;
    } else {
      card.style.background = 'radial-gradient(circle, #444, #222)';
    }

    if (source._colors?.darkSourceColor) {
      card.style.setProperty('--dark-source-color', source._colors.darkSourceColor);
    }
  }

  // --- Source header (logo + name) ---
  const header = document.createElement('div');
  header.className = 'source-header';
  if (source.logo) {
    const logo = document.createElement('img');
    logo.src = source.logo;
    logo.alt = source.name;
    logo.className = 'source-logo';
    header.appendChild(logo);
  }
  const name = document.createElement('span');
  name.textContent = source.name;
  name.className = 'source-name';
  header.appendChild(name);
  card.appendChild(header);

  // --- Info section (headline + date) ---
  const info = document.createElement('div');
  info.className = 'info';
  const h2 = document.createElement('h2');
  h2.textContent = truncateWords(normalizeHeadline(cleanTitle(item.title, source.name)), 18);
  const meta = document.createElement('div');
  meta.className = 'meta';
  meta.textContent = formatArticleDate(item.pubDate);
  info.appendChild(h2);
  info.appendChild(meta);

  // --- Content section (expanded view) ---
  const content = document.createElement('div');
  content.className = 'content';
  const p = document.createElement('p');
  p.textContent = truncateWords(
    stripHtmlTags(item.content || item.description || '')
      .replace(/Read More/gi, '')
      .trim(),
    28
  );
  const a = document.createElement('a');
  a.href = item.link;
  a.target = '_blank';
  a.rel = 'noopener';
  a.textContent = 'Read Full Article';
  content.appendChild(p);
  content.appendChild(a);

  card.appendChild(info);
  card.appendChild(content);

  // --- Click interaction (only one open at a time) ---
  card.addEventListener('click', (e) => {
    if (e.target.tagName === 'A') return;
    if (state.openCard && state.openCard !== card) {
      state.openCard.classList.remove('active');
    }
    const nowActive = !card.classList.contains('active');
    card.classList.toggle('active', nowActive);
    state.openCard = nowActive ? card : null;
  });

  return card;
}



function renderGrid(){
  gridEl.innerHTML = '';
  if(!state.articles.length){
    const empty = document.createElement('div');
    empty.className = 'empty';
    empty.textContent = 'No stories. Try refreshing.';
    gridEl.appendChild(empty);
    return;
  }
  const sorted = state.articles.sort((a,b)=> new Date(b.pubDate)-new Date(a.pubDate));
  sorted.forEach(item => gridEl.appendChild(item.card));
}

/* ---------- Feed loading (Worker proxy + cache) ---------- */
async function loadFeed(source){
  const cachedUrl = `https://rss-proxy.davidbusch-02.workers.dev/cached?url=${encodeURIComponent(source.url)}`;
  const liveUrl   = `https://rss-proxy.davidbusch-02.workers.dev/?url=${encodeURIComponent(source.url)}`;
  let data = null;

  try{
    const cachedRes = await fetch(cachedUrl);
    if(cachedRes.ok) data = await cachedRes.json();
  }catch{}

  if(!data || !data.items || !data.items.length){
    const liveRes = await fetch(liveUrl);
    data = await liveRes.json();
  }
  if(!data.items) return;

  // Compute per-source colours once (for no-image cards)
    if(!source._colors){
      source._colors = await getGradientFromLogo(source.logo);
    }


  for(const item of data.items){
    item.pubDate ||= item.isoDate || item.published || item.date || new Date().toISOString();

    // Decide thumbnail:
    let hasImage = !!item.thumbnail;
    // If the thumbnail is a generated placeholder URL, treat as no-image:
    if(hasImage && /placehold\.co/.test(item.thumbnail)) hasImage = false;

    // Optional: try a Pexels fallback only if really no image and you want one
    // (commented out to embrace your "colour card" approach)
    // if(!hasImage){
    //   const fallback = await getPexelsImage(cleanTitle(item.title, source.name));
    //   if(fallback){ item.thumbnail = fallback; hasImage = true; }
    // }

    const id = btoa(item.link);
    if(state.articles.some(a => a.id === id)) continue;

    const card = makeCardDOM(item, source);
    state.articles.push({ ...item, card, id });
  }
}




async function loadAllFeeds(){
  gridEl.innerHTML = '<div class="empty">Loading feeds…</div>';
  state.articles = [];

  try{
    const feedRes = await fetch('feeds.json');
    const feedData = await feedRes.json();
    state.allSources = Object.values(feedData).flat();

    await Promise.all(state.allSources.map(loadFeed));

    renderGrid();
    localStorage.setItem('feedCache_grid', JSON.stringify(state.articles.map(a=>({
      id:a.id,
      link:a.link,
      title:a.title,
      pubDate:a.pubDate,
      description:a.description,
      content:a.content,
      thumbnail:a.thumbnail || null,
      sourceName:a.card?.dataset?.source || '',
      sourceColor:a.sourceColor || null,
      darkSourceColor:a.darkSourceColor || null
    })) ));
    localStorage.setItem('feedTimestamp_grid', Date.now());
    showToast();
  }catch(err){
    gridEl.innerHTML = `<div class="empty">Error loading feeds: ${err.message}</div>`;
  }
}

/* ---------- Cached boot ---------- */
(function bootFromCache(){
  const saved = localStorage.getItem('feedCache_grid');
  const savedAt = localStorage.getItem('feedTimestamp_grid');
  if(saved && savedAt && Date.now() - savedAt < 1000*60*30){
    try{
      const cacheItems = JSON.parse(saved);
      state.articles = cacheItems.map(ci=>{
        const source = { name: ci.sourceName || 'Source', logo: null };
        const item = {
          link: ci.link, title: ci.title, pubDate: ci.pubDate,
          description: ci.description, content: ci.content,
          thumbnail: ci.thumbnail, sourceColor: ci.sourceColor, darkSourceColor: ci.darkSourceColor
        };
        const card = makeCardDOM(item, source);
        return { ...item, card, id: ci.id };
      });
      renderGrid();
    }catch(e){
      console.warn('Local cache corrupted, refetching');
    }
  }
})();



/* ---------- First load ---------- */
loadAllFeeds();
</script>

<!-- ColorThief for logo-based palette -->
<script src="https://unpkg.com/colorthief/dist/color-thief.umd.js"></script>
<script>
/* Date */
(function setDate(){
  const el=document.getElementById("currentDate");
  const today=new Date();
  el.textContent=today.toLocaleDateString("en-US",{month:"long",day:"numeric"});
})();

/* Scroll Hide/Show for Frosted Topbar */
let lastScroll=0;
const topbar=document.getElementById('topbar');
window.addEventListener('scroll',()=>{
  const curr=window.scrollY;
  if(curr>lastScroll && curr>80){ topbar.classList.add('hidden'); }
  else if(curr<lastScroll-10){ topbar.classList.remove('hidden'); }
  lastScroll=curr;
});

/* Button Logic */
const backBtn=document.getElementById('backToTopBtn');
window.addEventListener('scroll',()=>{
  if(window.scrollY>400) backBtn.classList.add('visible');
  else backBtn.classList.remove('visible');
});
backBtn.addEventListener('click',()=>window.scrollTo({top:0,behavior:'smooth'}));

const refreshBtn=document.getElementById('refreshBtn');
refreshBtn.addEventListener('click',()=>{
  const icon=refreshBtn.querySelector('i');
  icon.classList.add('bx-spin');
  setTimeout(()=>icon.classList.remove('bx-spin'),1500);
});
</script>


</body>
</html>
 